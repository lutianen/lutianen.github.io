[{"categories":["Design Patten"],"content":" è®¾è®¡æ¨¡å¼: åœ¨ç‰¹å®šç¯å¢ƒä¸‹äººä»¬è§£å†³æŸç±»é‡å¤å‡ºç°çš„ä¸€å¥—æˆåŠŸæˆ–æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ. ","date":"2024-07-28","objectID":"/design-pattern/:0:0","tags":["Design Patten"],"title":"Design Pattern","uri":"/design-pattern/"},{"categories":["Design Patten"],"content":"I. å‰è¨€ è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£å¹¶ä¸”ä¿è¯ä»£ç å¯é æ€§ã€‚ ç®€å•æ¥è¯´ï¼Œè®¾è®¡æ¨¡å¼å°±æ˜¯åœ¨ä¸€å®šç¯å¢ƒä¸‹ï¼Œç”¨å›ºå®šå¥—è·¯è§£å†³é—®é¢˜ã€‚ è®¾è®¡æ¨¡å¼çš„åŸºç¡€ï¼šå¤šæ€ ","date":"2024-07-28","objectID":"/design-pattern/:1:0","tags":["Design Patten"],"title":"Design Pattern","uri":"/design-pattern/"},{"categories":["Design Patten"],"content":"é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ \u003e ç›®çš„ï¼šé«˜å†…èšã€ä½è€¦åˆ å¦‚ä½•åŒæ—¶æâ¾¼â¼€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯å¤â½¤æ€§æ˜¯â¾¯å‘å¯¹è±¡è®¾è®¡éœ€è¦è§£å†³çš„æ ¸â¼¼é—®é¢˜ä¹‹â¼€ã€‚ â¾¯å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¸ºâ½€æŒå¯ç»´æŠ¤æ€§å¤â½¤â½½è¯â½£ï¼Œè¿™äº›åŸåˆ™è•´å«åœ¨å¾ˆå¤šè®¾è®¡æ¨¡å¼ä¸­ï¼Œå®ƒä»¬æ˜¯ä»è®¸å¤šè®¾è®¡â½…æ¡ˆä¸­æ€»ç»“å‡ºçš„æŒ‡å¯¼æ€§åŸåˆ™ã€‚ å•ä¸€èŒè´£åŸåˆ™: ç±»çš„èŒè´£å•â¼€ï¼Œå¯¹å¤–åªæä¾›â¼€ç§åŠŸèƒ½ï¼Œâ½½å¼•èµ·ç±»å˜åŒ–çš„åŸå› éƒ½åº”è¯¥åªæœ‰â¼€ä¸ª å¼€é—­åŸåˆ™: ç±»çš„æ”¹åŠ¨æ˜¯é€šè¿‡å¢åŠ ä»£ç è¿›â¾çš„ï¼Œâ½½ä¸æ˜¯ä¿®æ”¹æºä»£ç  é‡Œå¼ä»£æ¢åŸåˆ™: ä»»ä½•æŠ½è±¡ç±»å‡ºç°çš„åœ°â½…éƒ½å¯ä»¥â½¤ä»–çš„å®ç°ç±»è¿›â¾æ›¿æ¢ï¼Œå®é™…å°±æ˜¯è™šæ‹Ÿæœºåˆ¶ï¼Œè¯­â¾”çº§åˆ«å®ç°â¾¯å‘å¯¹è±¡åŠŸèƒ½ ä¾èµ–å€’è½¬åŸåˆ™: ä¾èµ–äºæŠ½è±¡(æ¥â¼)ï¼Œä¸è¦ä¾èµ–å…·ä½“çš„å®ç°(ç±»)ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹æ¥â¼ç¼–ç¨‹ æ¥å£éš”ç¦»åŸåˆ™: ä¸åº”è¯¥å¼ºè¿«â½¤æˆ·çš„ç¨‹åºä¾èµ–ä»–ä»¬ä¸éœ€è¦çš„æ¥â¼â½…æ³•ã€‚â¼€ä¸ªæ¥â¼åº”è¯¥åªæä¾›â¼€ç§å¯¹å¤–åŠŸèƒ½ï¼Œä¸åº”è¯¥æŠŠæ‰€æœ‰æ“ä½œéƒ½å°è£…åˆ°â¼€ä¸ªæ¥â¼ä¸­å» åˆæˆå¤ç”¨åŸåˆ™: å¦‚æœä½¿â½¤ç»§æ‰¿ï¼Œä¼šå¯¼è‡´â½—ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°â¼¦ç±»çš„â¾ä¸ºã€‚å¦‚æœä½¿â½¤å¯¹è±¡ç»„åˆï¼Œå°±é™ä½äº†è¿™ç§ä¾èµ–å…³ç³»ã€‚å¯¹äºç»§æ‰¿å’Œç»„åˆï¼Œä¼˜å…ˆä½¿â½¤ç»„åˆ è¿ªç±³ç‰¹æ³•åˆ™: â¼€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½å°‘çš„äº†è§£ï¼Œä»â½½é™ä½å„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæâ¾¼ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ ","date":"2024-07-28","objectID":"/design-pattern/:1:1","tags":["Design Patten"],"title":"Design Pattern","uri":"/design-pattern/"},{"categories":["Design Patten"],"content":"II. åˆ†ç±» åˆ›å»ºå‹ï¼ˆCreationalï¼‰æ¨¡å¼ï¼šå¦‚ä½•åˆ›å»ºå¯¹è±¡ æ¨¡å¼åç§° ç”¨é€” å•ä¾‹æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ ç®€å•å·¥å‚æ–¹æ³• ğŸŒŸğŸŒŸğŸŒŸ é€šè¿‡ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ¥è´Ÿè´£åˆ›å»ºå…¶ä»–ç±»çš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„åŸºç±» æŠ½è±¡å·¥å‚æ–¹æ³• ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±» åŸå‹æ¨¡å¼ â½¤åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·â»‰è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ å»ºé€ è€…æ¨¡å¼ å°†â¼€ä¸ªå¤æ‚çš„æ„å»ºä¸å…¶è¡¨ç¤ºç›¸åˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º ç»“æ„å‹ï¼ˆStructuralï¼‰æ¨¡å¼ï¼šå¦‚ä½•å®ç°ç±»æˆ–å¯¹è±¡çš„ç»„åˆ æ¨¡å¼åç§° ç”¨é€” é€‚é…å™¨æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ æ¡¥æ¥æ¨¡å¼ å°†æŠ½è±¡éƒ¨åˆ†ä¸å®é™…éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹çš„å˜åŒ– ç»„åˆæ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º â€œéƒ¨åˆ† - æ•´ä½“â€ çš„å±‚æ¬¡ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ è£…é¥°æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸ åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼šå°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œæ­¤æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´åŠ çµæ´» å¤–è§‚æ¨¡å¼ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ ä¸ºå­ç³»ç»Ÿçš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œæ­¤æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¬¡æ¥å£ï¼Œä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ äº«å…ƒæ¨¡å¼ ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆçš„æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦çš„å¯¹è±¡ ä»£ç†æ¨¡å¼ ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—® è¡Œä¸ºå‹ï¼ˆBehavioralï¼‰æ¨¡å¼ï¼šç±»æˆ–å¯¹è±¡å¦‚ä½•äº¤äº’ä»¥åŠå¦‚ä½•åˆ†é…æŒ‡è´£ ","date":"2024-07-28","objectID":"/design-pattern/:2:0","tags":["Design Patten"],"title":"Design Pattern","uri":"/design-pattern/"},{"categories":["Design Patten"],"content":"III. åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ ","date":"2024-07-28","objectID":"/design-pattern/:3:0","tags":["Design Patten"],"title":"Design Pattern","uri":"/design-pattern/"},{"categories":["Design Patten"],"content":"1. ç®€å•å·¥å‚æ¨¡å¼ äº¦ç§°ï¼šè™šæ‹Ÿæ„é€ å‡½æ•°ã€Virtual Constructorã€Factory Method æ„å›¾ï¼šå®ƒæ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå…¶åœ¨çˆ¶ç±»ä¸­æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œå…è®¸å­ç±»å†³å®šå®ä¾‹åŒ–å¯¹è±¡çš„ç±»å‹ ","date":"2024-07-28","objectID":"/design-pattern/:3:1","tags":["Design Patten"],"title":"Design Pattern","uri":"/design-pattern/"},{"categories":["Golang","Project Layout","Stardard"],"content":"Go åº”ç”¨ç¨‹åºé¡¹ç›®çš„åŸºæœ¬å¸ƒå±€ä»‹ç» ","date":"2024-07-13","objectID":"/go-proj-layout/:0:0","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"Go Module ä» Go 1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œé™¤éå­˜åœ¨ç‰¹å®šä¸ä½¿ç”¨ Go Modules çš„ç†ç”±ï¼Œå¦åˆ™è¯·ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸€æ—¦ä½¿ç”¨ï¼Œå°±æ— éœ€å†æ‹…å¿ƒ $GOPATH ä»¥åŠé¡¹ç›®çš„å­˜æ”¾ä½ç½®ã€‚ ","date":"2024-07-13","objectID":"/go-proj-layout/:1:0","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"Go ç›®å½• ","date":"2024-07-13","objectID":"/go-proj-layout/:2:0","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"/cmd /cmdï¼Œæœ¬é¡¹ç›®çš„ä¸»å¹²ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ç›®å½•ååº”è¯¥ä¸ä½ æƒ³è¦çš„å¯æ‰§è¡Œç¨‹åºçš„åç§°ç›¸å¯¹åº”ï¼Œä¾‹å¦‚ /cmd/myAppã€‚ åœ¨ /cmd ç›®å½•ä¸‹ï¼Œä¸åº”è¯¥æ”¾ç½®å¤ªå¤šä»£ç ï¼š å¦‚æœè®¤ä¸ºä»£ç å¯ä»¥å¯¼å…¥å¹¶å¯åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥ä½äº /pkg ç›®å½•ä¸­. å¦‚æœä»£ç ä¸æ˜¯å¯é‡ç”¨çš„ï¼Œæˆ–è€…ä¸å¸Œæœ›å…¶ä»–äººé‡ç”¨å®ƒï¼Œé‚£ä¹ˆåº”è¯¥ä½äº /internal ç›®å½•ä¸­. è¯¥ç›®å½•ä¸‹ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªå°çš„ main å‡½æ•°ï¼Œä» /internal å’Œ pkg ç›®å½•ä¸­å¯¼å…¥å’Œè°ƒç”¨ä»£ç ï¼Œé™¤æ­¤ä¹‹å¤–æ²¡æœ‰åˆ«çš„ä¸œè¥¿. å¾®æœåŠ¡ä¸­çš„ app æœåŠ¡ç±»å‹åˆ†ä¸º4ç±»ï¼šinterfaceã€serviceã€jobã€admin |---cmd | |---kydenapp-admin | |---kydenapp-interface | |---kydenapp-job | |---kydenapp-service | |---kydenapp-task interface: å¯¹å¤–çš„ BFF æœåŠ¡ï¼Œæ¥å—æ¥è‡ªç”¨æˆ·çš„è¯·æ±‚ï¼Œæ¯”å¦‚æš´éœ²äº† HTTP/gRPC æ¥å£ service: å¯¹å†…çš„å¾®æœåŠ¡ï¼Œä»…æ¥å—æ¥è‡ªå†…éƒ¨å…¶ä»–æœåŠ¡æˆ–ç½‘å…³çš„è¯·æ±‚ï¼Œæ¯”å¦‚æš´éœ²äº† gRPC æ¥å£åªå¯¹å†…æœåŠ¡ admin: åŒºåˆ«äº serviceï¼Œæ›´å¤šæ˜¯é¢å‘è¿è¥æµ‹çš„æœåŠ¡ï¼Œé€šå¸¸æ•°æ®æƒé™æ›´é«˜ï¼Œéš”ç¦»å¸¦æ¥æ›´å¥½çš„ä»£ç çº§åˆ«å®‰å…¨ job: æµå¼ä»»åŠ¡å¤„ç†çš„æœåŠ¡ï¼Œä¸Šæ¸¸ä¸€èˆ¬ä¾èµ– message broker task: å®šæ—¶ä»»åŠ¡ï¼Œç±»ä¼¼ cronjobï¼Œéƒ¨ç½²åˆ° task æ‰˜ç®¡å¹³å°ä¸­ /cmd åº”ç”¨ç›®å½•è´Ÿè´£ç¨‹åºçš„: å¯åŠ¨ã€å…³é—­ã€é…ç½®åˆå§‹åŒ–ç­‰ DTO(Data Transfer Object)ï¼Œæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œè¿™ä¸ªæ¦‚å¿µæ¥æºäº J2EE çš„è®¾è®¡æ¨¡å¼ï¼Œ ä½†è¿™é‡Œæ³›æŒ‡ç”¨äºå±•ç¤ºå±‚/APIå±‚ä¸æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ä¹‹é—´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ã€‚ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:1","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"internal internalï¼Œç§æœ‰åº”ç”¨ç¨‹åºå’Œåº“ä»£ç ï¼Œå®ƒæ˜¯ä¸å¸Œæœ›å…¶ä»–äººåœ¨å…¶åº”ç”¨ç¨‹åºæˆ–åº“ä¸­å¯¼å…¥çš„ä»£ç ã€‚ è¯¥ç›®å½•ç”± Go å¼ºåˆ¶æ‰§è¡Œï¼Œç¡®ä¿ç§æœ‰åŒ…ä¸å¯å¯¼å…¥ã€‚ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:2","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"pkg /pkgï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„åº“ä»£ç ï¼ˆä¾‹å¦‚ /pkg/mypubliclibï¼‰. å¦‚æœåº”ç”¨ç¨‹åºé¡¹ç›®çœŸçš„å¾ˆå°ï¼Œå¹¶ä¸”é¢å¤–çš„åµŒå¥—å¹¶ä¸èƒ½å¢åŠ å¤šå°‘ä»·å€¼(é™¤éä½ çœŸçš„æƒ³è¦:-)ï¼Œé‚£å°±ä¸è¦ä½¿ç”¨å®ƒã€‚ å½“å®ƒå˜å¾—è¶³å¤Ÿå¤§æ—¶ï¼Œæ ¹ç›®å½•ä¼šå˜å¾—éå¸¸ç¹çæ—¶(å°¤å…¶æ˜¯å½“ä½ æœ‰å¾ˆå¤šé Go åº”ç”¨ç»„ä»¶æ—¶)ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ã€‚ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:3","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"api /apiï¼Œåè®®å®šä¹‰ç›®å½•ï¼Œ(xxapi.proto) protobuf æ–‡ä»¶ï¼Œä»¥åŠç”Ÿæˆçš„ go æ–‡ä»¶ã€‚ é€šå¸¸æŠŠ api æ–‡æ¡£ç›´æ¥åœ¨ proto æ–‡ä»¶ä¸­æè¿°ã€‚ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:4","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"configs é…ç½®æ–‡ä»¶æ¨¡ç‰ˆæˆ–é»˜è®¤é…ç½® ","date":"2024-07-13","objectID":"/go-proj-layout/:2:5","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"scripts æ‰§è¡Œå„ç§æ„å»ºã€å®‰è£…ã€åˆ†æç­‰æ“ä½œçš„è„šæœ¬ï¼Œæ˜¯çš„æ ¹çº§åˆ«çš„ Makefile å˜å¾—å°è€Œç®€å• ","date":"2024-07-13","objectID":"/go-proj-layout/:2:6","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"test é¢å¤–çš„å¤–éƒ¨æµ‹è¯•åº”ç”¨ç¨‹åºå’Œæµ‹è¯•æ•°æ® Go ä¼šå¿½ç•¥ä»¥ . æˆ– _ å¼€å¤´çš„ç›®å½•å’Œæ–‡ä»¶ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:7","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"docs è®¾è®¡å’Œç”¨æˆ·æ–‡æ¡£ï¼ˆgodoc ç”Ÿæˆçš„æ–‡æ¡£é™¤å¤–ï¼‰ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:8","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"tools é¡¹ç›®çš„æ”¯æŒå·¥å…·ï¼Œå¯ä»¥ä» /pkg å’Œ /internal ç›®å½•å¯¼å…¥ä»£ç  ","date":"2024-07-13","objectID":"/go-proj-layout/:2:9","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"examples åº”ç”¨ç¨‹åºå’Œ/æˆ–å…¬å…±åº“çš„ç¤ºä¾‹ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:10","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"third_party å¤–éƒ¨è¾…åŠ©å·¥å…·ï¼Œåˆ†å‰ä»£ç å’Œå…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆä¾‹å¦‚ Swagger UIï¼‰ ","date":"2024-07-13","objectID":"/go-proj-layout/:2:11","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"assets ä¸å­˜å‚¨åº“ä¸€èµ·ä½¿ç”¨çš„å…¶ä»–èµ„æºï¼ˆå›¾åƒã€å¾½æ ‡ç­‰ï¼‰ æŒ‰ç†æ¥è¯´æˆ‘ä»¬ä¸åº”è¯¥ src ç›®å½•ï¼Œä½†æœ‰äº› Go é¡¹ç›®æ‹¥æœ‰ä¸€ä¸ª src æ–‡ä»¶å¤¹ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨å¼€å‘äººå‘˜å…·æœ‰ Java èƒŒæ™¯ $GOPATH ç¯å¢ƒå˜é‡æŒ‡å‘ä½ çš„(å½“å‰)å·¥ä½œç©ºé—´(é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæŒ‡å‘é windows ç³»ç»Ÿä¸Šçš„ $HOME/go)ï¼Œè¿™ä¸ªå·¥ä½œç©ºé—´åŒ…æ‹¬é¡¶å±‚ /pkg, /bin å’Œ /src ç›®å½•ï¼Œè€Œå®é™…é¡¹ç›®æœ€ç»ˆæ˜¯ /src ä¸‹çš„ä¸€ä¸ªå­ç›®å½•ï¼Œå³ /xxx/workspace/src/proj/src/xxx.goï¼ˆGo 1.11 ä¹‹åï¼Œé¡¹ç›® proj å¯ä»¥æ”¾åœ¨ GOPATH ä¹‹å¤–ï¼‰. ","date":"2024-07-13","objectID":"/go-proj-layout/:2:12","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Project Layout","Stardard"],"content":"Reference https://talks.golang.org/2014/names.slide https://golang.org/doc/effective_go.html#names https://blog.golang.org/package-names https://go.dev/wiki/CodeReviewComments Style guideline for Go packages (rakyll/JBD) ","date":"2024-07-13","objectID":"/go-proj-layout/:3:0","tags":["Golang","Project Layout","Stardard"],"title":"Stardard Go Project Layout","uri":"/go-proj-layout/"},{"categories":["Golang","Context"],"content":"Contextï¼šå½“éœ€è¦åœ¨å¤šä¸ª Goroutine ä¸­ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Context å®ç° ","date":"2024-06-01","objectID":"/context-of-go/:0:0","tags":["Golang","Context"],"title":"Context of Go","uri":"/context-of-go/"},{"categories":["Golang","Context"],"content":"Context Context é™¤äº†ç”¨æ¥ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç”¨æ¥ä¼ é€’ç»ˆç»“æ‰§è¡Œå­ä»»åŠ¡çš„ç›¸å…³ä¿¡å·ï¼Œç»ˆæ­¢å¤šä¸ªæ‰§è¡Œå­ä»»åŠ¡çš„ Goroutineã€‚ context.Context æ¥å£æ•°æ®ç»“æ„ï¼š // A Context carries a deadline, a cancellation signal, and other values across // API boundaries. // // Context's methods may be called by multiple goroutines simultaneously. type Context interface { // Deadline returns the time when work done on behalf of this context // should be canceled. Deadline returns ok==false when no deadline is // set. Successive calls to Deadline return the same results. Deadline() (deadline time.Time, ok bool) // Done returns a channel that's closed when work done on behalf of this // context should be canceled. Done may return nil if this context can // never be canceled. Successive calls to Done return the same value. // The close of the Done channel may happen asynchronously, // after the cancel function returns. // // WithCancel arranges for Done to be closed when cancel is called; // WithDeadline arranges for Done to be closed when the deadline // expires; WithTimeout arranges for Done to be closed when the timeout // elapses. // // Done is provided for use in select statements: // // // Stream generates values with DoSomething and sends them to out // // until DoSomething returns an error or ctx.Done is closed. // func Stream(ctx context.Context, out chan\u003c- Value) error { // for { // v, err := DoSomething(ctx) // if err != nil { // return err // } // select { // case \u003c-ctx.Done(): // return ctx.Err() // case out \u003c- v: // } // } // } // // See https://blog.golang.org/pipelines for more examples of how to use // a Done channel for cancellation. Done() \u003c-chan struct{} // If Done is not yet closed, Err returns nil. // If Done is closed, Err returns a non-nil error explaining why: // Canceled if the context was canceled // or DeadlineExceeded if the context's deadline passed. // After Err returns a non-nil error, successive calls to Err return the same error. Err() error // Value returns the value associated with this context for key, or nil // if no value is associated with key. Successive calls to Value with // the same key returns the same result. // // Use context values only for request-scoped data that transits // processes and API boundaries, not for passing optional parameters to // functions. // // A key identifies a specific value in a Context. Functions that wish // to store values in Context typically allocate a key in a global // variable then use that key as the argument to context.WithValue and // Context.Value. A key can be any type that supports equality; // packages should define keys as an unexported type to avoid // collisions. // // Packages that define a Context key should provide type-safe accessors // for the values stored using that key: // // // Package user defines a User type that's stored in Contexts. // package user // // import \"context\" // // // User is the type of value stored in the Contexts. // type User struct {...} // // // key is an unexported type for keys defined in this package. // // This prevents collisions with keys defined in other packages. // type key int // // // userKey is the key for user.User values in Contexts. It is // // unexported; clients use user.NewContext and user.FromContext // // instead of using this key directly. // var userKey key // // // NewContext returns a new Context that carries value u. // func NewContext(ctx context.Context, u *User) context.Context { // return context.WithValue(ctx, userKey, u) // } // // // FromContext returns the User value stored in ctx, if any. // func FromContext(ctx context.Context) (*User, bool) { // u, ok := ctx.Value(userKey).(*User) // return u, ok // } Value(key any) any } Deadlineï¼šè¿”å› Context è¢«å–æ¶ˆçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå·¥ä½œçš„æˆªè‡³æ—¥æœŸï¼› Doneï¼šè¿”å›ä¸€ä¸ª channelï¼Œè¿™ä¸ª channel ä¼šåœ¨å½“å‰å·¥ä½œå®Œæˆæˆ–è€…ä¸Šä¸‹æ–‡è¢«å–æ¶ˆä¹‹åå…³é—­ï¼Œå¤šæ¬¡è°ƒç”¨ Done æ–¹æ³•ä¼šè¿”å›åŒä¸€ä¸ª channelï¼› Errï¼šæ”¾å› Context ç»“æŸçš„åŸå› ï¼Œåªä¼šåœ¨ Done è¿”å›çš„ channel è¢«å…³é—­æ—¶æ‰ä¼šè¿”å›éç©ºçš„å€¼ï¼Œå¦‚æœ Context è¢«å–æ¶ˆï¼Œä¼šè¿”å› Canceled é”™è¯¯ï¼›å¦‚æœ Context è¶…æ—¶ï¼Œä¼šè¿”å› DeadlineExceeded é”™è¯¯ï¼› Valueï¼šå¯ç”¨äºä» Context ä¸­è·å–ä¼ é€’çš„é”®å€¼ä¿¡æ¯ï¼› ","date":"2024-06-01","objectID":"/context-of-go/:1:0","tags":["Golang","Context"],"title":"Context of Go","uri":"/context-of-go/"},{"categories":["Golang","Context"],"content":"Example åœ¨ Web è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚å¯èƒ½å¯åŠ¨å¤šä¸ª goroutine ååŒå·¥ä½œï¼Œè¿™äº› goroutine ä¹‹é—´å¯èƒ½éœ€è¦å…±äº«è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¸”å½“è¯·æ±‚è¢«å–æ¶ˆæˆ–è€…æ‰§è¡Œè¶…æ—¶æ—¶ï¼Œè¯¥è¯·æ±‚å¯¹åº”çš„æ‰€æœ‰ goroutine éƒ½éœ€è¦å¿«é€Ÿç»“æŸï¼Œé‡Šæ”¾èµ„æºï¼ŒContext å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°åœºæ™¯è€Œå¼€å‘çš„ã€‚ package main import ( \"context\" \"fmt\" \"time\" ) const DB_ADDRESS = \"db_address\" const CALCULATE_VALUE = \"calculate_value\" func readDB(ctx context.Context, cost time.Duration) { fmt.Println(\"DB address is \", ctx.Value(DB_ADDRESS)) select { case \u003c-time.After(cost): fmt.Println(\"read data from db\") case \u003c-ctx.Done(): fmt.Println(ctx.Err()) } } func calculate(ctx context.Context, cost time.Duration) { fmt.Println(\"calculate value is\", ctx.Value(CALCULATE_VALUE)) select { case \u003c-time.After(cost): // æ¨¡æ‹Ÿæ•°æ®è®¡ç®— fmt.Println(\"calculate finish\") case \u003c-ctx.Done(): fmt.Println(ctx.Err()) // ä»»åŠ¡å–æ¶ˆçš„åŸå›  // ä¸€äº›æ¸…ç†å·¥ä½œ } } func main() { ctx := context.Background() // Add Context info ctx = context.WithValue(ctx, DB_ADDRESS, \"localhost:3306\") ctx = context.WithValue(ctx, CALCULATE_VALUE, \"123\") ctx, cancel := context.WithTimeout(ctx, time.Second*2) defer cancel() go readDB(ctx, time.Second*4) go calculate(ctx, time.Second*4) time.Sleep(time.Second * 5) } ä½¿ç”¨ Contextï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°åœ¨ä¸€ç»„ goroutine ä¸­ä¼ é€’å…±äº«å€¼ã€å–æ¶ˆä¿¡å·ã€deadline ç­‰ä¿¡æ¯ï¼ŒåŠæ—¶å…³é—­ä¸éœ€è¦çš„ goroutineã€‚ ","date":"2024-06-01","objectID":"/context-of-go/:2:0","tags":["Golang","Context"],"title":"Context of Go","uri":"/context-of-go/"},{"categories":["Golang","Context"],"content":"Reference Go Context ","date":"2024-06-01","objectID":"/context-of-go/:3:0","tags":["Golang","Context"],"title":"Context of Go","uri":"/context-of-go/"},{"categories":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"content":"æ·±å…¥ç†è§£ Golang Escape Analysisï¼šå˜é‡ä½•æ—¶é€ƒé€¸ï¼Ÿ ","date":"2024-05-19","objectID":"/golang-escape-analysis/:0:0","tags":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"title":"Golang Escape Analysis","uri":"/golang-escape-analysis/"},{"categories":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"content":"I. Golang Escape Ananlysis Golang ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å†³å®šæŠŠä¸€ä¸ªå˜é‡æ”¾åœ¨å †æ ˆè¿˜æ˜¯æ ˆä¸Šï¼Œå³é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰. Go å£°ç§°é€ƒé€¸åˆ†æå¯ä»¥é‡Šæ”¾ç¨‹åºå‘˜å…³äºå†…å­˜çš„ä½¿ç”¨é™åˆ¶ï¼Œæ›´å¤šåœ°å…³æ³¨ç¨‹åºé€»è¾‘æœ¬èº«ã€‚ ","date":"2024-05-19","objectID":"/golang-escape-analysis/:1:0","tags":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"title":"Golang Escape Analysis","uri":"/golang-escape-analysis/"},{"categories":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"content":"II. é€ƒé€¸è§„åˆ™ ä¼—æ‰€å‘¨çŸ¥ï¼Œå½“å˜é‡éœ€è¦ä½¿ç”¨å †ï¼ˆheapï¼‰ç©ºé—´æ—¶ï¼Œé‚£ä¹ˆå˜é‡å°±åº”è¯¥è¿›è¡Œé€ƒé€¸ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¼•ç”¨å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»æˆå‘˜è¿›è¡Œèµ‹å€¼ï¼Œå¯èƒ½å‡ºç°é€ƒé€¸ç°è±¡ï¼šå¯ä»¥ç†è§£ä¸ºè®¿é—®ä¸€ä¸ªå¼•ç”¨å¯¹è±¡å®é™…ä¸Šåº•å±‚å°±æ˜¯é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆæ¥é—´æ¥çš„è®¿é—®ï¼Œä½†å¦‚æœå†è®¿é—®é‡Œé¢çš„å¼•ç”¨æˆå‘˜å°±ä¼šæœ‰ç¬¬äºŒæ¬¡é—´æ¥è®¿é—®ï¼Œè¿™æ ·æ“ä½œè¿™éƒ¨åˆ†å¯¹è±¡çš„è¯ï¼Œæå¤§å¯èƒ½ä¼šå‡ºç°é€ƒé€¸çš„ç°è±¡ã€‚ Golang ä¸­çš„å¼•ç”¨ç±»å‹æœ‰å‡½æ•°ç±»å‹ func()ï¼Œæ¥å£ç±»å‹ interfaceï¼Œåˆ‡ç‰‡ç±»å‹ sliceï¼Œå­—å…¸ç±»å‹ mapï¼Œç®¡é“ç±»å‹ channelï¼ŒæŒ‡é’ˆç±»å‹ * ç­‰ã€‚ ","date":"2024-05-19","objectID":"/golang-escape-analysis/:2:0","tags":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"title":"Golang Escape Analysis","uri":"/golang-escape-analysis/"},{"categories":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"content":"é€ƒé€¸åœºæ™¯Iï¼š []interface{} ä½¿ç”¨ [] èµ‹å€¼ []interface{} æ•°æ®ç±»å‹ï¼Œå¿…å®šé€ƒé€¸ package main import \"fmt\" func main() { data := []interface{}{1, 2} val := data[0] fmt.Printf(\"%v\\n\", val) data[0] = 3 } $ go build -v -gcflags='-m' ./main.go command-line-arguments # command-line-arguments ./main.go:8:12: inlining call to fmt.Printf ./main.go:6:23: []interface {}{...} does not escape ./main.go:6:24: 1 escapes to heap ./main.go:6:27: 2 escapes to heap ./main.go:8:12: ... argument does not escape ./main.go:9:12: 3 escapes to heap ","date":"2024-05-19","objectID":"/golang-escape-analysis/:2:1","tags":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"title":"Golang Escape Analysis","uri":"/golang-escape-analysis/"},{"categories":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"content":"é€ƒé€¸åœºæ™¯IIï¼š map[string]interface{} ä½¿ç”¨ [] èµ‹å€¼ map[string]interface{} æ•°æ®ç±»å‹ï¼Œå¿…å®šé€ƒé€¸ package main import \"fmt\" func main() { dat := make(map[string]interface{}) dat[\"BlogName\"] = \"Kyden's Blog\" val := dat[\"BlogName\"] fmt.Printf(\"%v\\n\", val) } $ go build -v -gcflags='-m' ./main.go command-line-arguments # command-line-arguments ./main.go:9:12: inlining call to fmt.Printf ./main.go:6:13: make(map[string]interface {}) does not escape ./main.go:7:20: \"Kyden's Blog\" escapes to heap ./main.go:9:12: ... argument does not escape ","date":"2024-05-19","objectID":"/golang-escape-analysis/:2:2","tags":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"title":"Golang Escape Analysis","uri":"/golang-escape-analysis/"},{"categories":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"content":"é€ƒé€¸åœºæ™¯ IIIï¼š map[interface{}]interface{} ä½¿ç”¨ [] èµ‹å€¼ map[interface{}]interface{} æ•°æ®ç±»å‹ï¼Œå¿…å®šé€ƒé€¸ package main import ( \"fmt\" ) func main() { dat := make(map[interface{}]interface{}) dat[\"BlogName\"] = \"Kyden's Blog\" val := dat[\"BlogName\"] fmt.Printf(\"%v\\n\", val) } $ go build -v -gcflags='-m' ./main.go command-line-arguments # command-line-arguments ./main.go:11:12: inlining call to fmt.Printf ./main.go:8:13: make(map[interface {}]interface {}) does not escape ./main.go:9:6: \"BlogName\" escapes to heap ./main.go:9:20: \"Kyden's Blog\" escapes to heap ./main.go:10:13: \"BlogName\" does not escape ./main.go:11:12: ... argument does not escape é€ƒé€¸åœºæ™¯ IVï¼šmap[string][]string map[string][]string æ•°æ®ç±»å‹ï¼Œèµ‹å€¼ä¼šå‘ç”Ÿ []string é€ƒé€¸ package main import ( \"fmt\" ) func main() { dat := make(map[string][]string) dat[\"BlogName\"] = []string{\"Kyden's Blog\"} val := dat[\"BlogName\"] fmt.Printf(\"%v\\n\", val) } $ go build -v -gcflags='-m' ./main.go command-line-arguments # command-line-arguments ./main.go:11:12: inlining call to fmt.Printf ./main.go:8:13: make(map[string][]string) does not escape ./main.go:9:28: []string{...} escapes to heap ./main.go:11:12: ... argument does not escape ./main.go:11:21: val escapes to heap é€ƒé€¸åœºæ™¯ Vï¼š[]*int []*int æ•°æ®ç±»å‹ï¼Œèµ‹å€¼çš„å³å€¼ä¼šå‘ç”Ÿé€ƒé€¸ package main import \"fmt\" func main() { dat := []*int{nil} a := 10 dat[0] = \u0026a fmt.Printf(\"%v\\r\\n\", *dat[0]) fmt.Printf(\"%v\\r\\n\", dat[0]) } $ go build -v -gcflags='-m' ./main.go command-line-arguments # command-line-arguments ./main.go:9:12: inlining call to fmt.Printf ./main.go:10:12: inlining call to fmt.Printf ./main.go:7:2: moved to heap: a ./main.go:6:15: []*int{...} does not escape ./main.go:9:12: ... argument does not escape ./main.go:9:23: *dat[0] escapes to heap ./main.go:10:12: ... argument does not escape é€ƒé€¸åœºæ™¯ VIï¼šfunc(*int) func(*int) æ•°æ®ç±»å‹ï¼Œè¿›è¡Œå‡½æ•°èµ‹å€¼ï¼Œä¼šä½¿ä¼ é€’çš„å½¢å‚é€ƒé€¸ package main import \"fmt\" func f(a *int) { fmt.Printf(\"%v\\n\", *a) return } func main() { a := 10 fn := f fn(\u0026a) fmt.Printf(\"a = %v\\n\", a) } $ go build -v -gcflags='-m' ./main.go # command-line-arguments ./main.go:6:12: inlining call to fmt.Printf ./main.go:14:12: inlining call to fmt.Printf ./main.go:5:8: a does not escape ./main.go:6:12: ... argument does not escape ./main.go:6:21: *a escapes to heap ./main.go:14:12: ... argument does not escape ./main.go:14:25: a escapes to heap ","date":"2024-05-19","objectID":"/golang-escape-analysis/:2:3","tags":["Golang","é€ƒé€¸åˆ†æ","Escape Analysis","Heap","Stack"],"title":"Golang Escape Analysis","uri":"/golang-escape-analysis/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"æ·±å…¥ç†è§£ GMP: Go çš„è°ƒåº¦æµç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§-æ¶ˆè´¹æµç¨‹. ","date":"2024-05-15","objectID":"/gmp-of-go/:0:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"I. è¿›ç¨‹(Process)ã€çº¿ç¨‹ (Thread) ä¸åç¨‹ (Co-routine) ","date":"2024-05-15","objectID":"/gmp-of-go/:1:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"è¿›ç¨‹ Process åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹ä½¿ç”¨è¿›ç¨‹æ§åˆ¶å— (PCB, Process Control Block) æ•°æ®ç»“æ„ task_struct æ¥æè¿°ï¼ŒPCB æ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡è¯†ã€‚ è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç¨‹åºä¸€æ—¦è¿è¡Œå°±æ˜¯è¿›ç¨‹ï¼› è¿›ç¨‹å¯ä»¥è®¤ä¸ºæ˜¯ç¨‹åºæ‰§è¡Œçš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œä¸”æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼› ä¸€ä¸ªè¿›ç¨‹æ— æ³•ç›´æ¥è®¿é—®åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„å˜é‡å’Œæ•°æ®ç»“æ„ï¼Œå¦‚æœå¸Œæœ›ä¸€ä¸ªè¿›ç¨‹å»è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œéœ€è¦ä½¿ç”¨è¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå¦‚fifoã€pipeã€signalã€socket ç­‰ï¼› è¿›ç¨‹è°ƒåº¦ç®—æ³•ï¼šå…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ã€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€æœ€çŸ­å‰©ä½™ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€æœ€é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€æœ€é«˜ä¼˜å…ˆçº§ä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€æ—¶é—´ç‰‡è½®è½¬ç®—æ³•ï¼ˆå…¬å¹³è°ƒåº¦ï¼Œ$20 - 50 ms$ï¼‰ã€å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•($æœ€é«˜ä¼˜å…ˆçº§ + æ—¶é—´ç‰‡è½®è½¬$)ï¼› ","date":"2024-05-15","objectID":"/gmp-of-go/:1:1","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"çº¿ç¨‹ Thread ç”¨æˆ·æ€çº¿ç¨‹ï¼Œæ˜¯åŸºäºç”¨æˆ·æ€çš„çº¿ç¨‹ç®¡ç†åº“æ¥å®ç°çš„ï¼Œçº¿ç¨‹æ§åˆ¶å— (Thread Control Block) ä¹Ÿæ˜¯åœ¨åº“é‡Œå®ç°ï¼Œæ“ä½œç³»ç»Ÿåªèƒ½çœ‹åˆ°æ•´ä¸ªè¿›ç¨‹çš„PCBï¼Œå³è¿›ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å±äºå¤šå¯¹ä¸€çš„æ¨¡å‹ã€‚ å†…æ ¸æ€çº¿ç¨‹(Thread)ï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œå¯¹åº”çš„ TCB å­˜å‚¨åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œä¸”å…¶åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦éƒ½ç”±æ“ä½œç³»ç»Ÿå®Œæˆï¼› è½»é‡çº§çº¿ç¨‹ LWP(Light-weight process)ï¼Œæ˜¯ç”±å†…æ ¸æ”¯æŒçš„ç”¨æˆ·çº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª LWPï¼Œæ¯ä¸ª LWP æ˜¯è·Ÿå†…æ ¸çº¿ç¨‹ä¸€å¯¹ä¸€æ˜ å°„çš„ï¼Œå³ LWP éƒ½æ˜¯ç”±ä¸€ä¸ªå†…æ ¸çº¿ç¨‹æ”¯æŒï¼Œè€Œä¸” LWP æ˜¯ç”±å†…æ ¸ç®¡ç†å¹¶åƒæ™®é€šè¿›ç¨‹ä¸€æ ·è¢«è°ƒåº¦ã€‚ åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼ŒLWP å’Œ æ™®é€šè¿›ç¨‹çš„åŒºåˆ«åœ¨äºï¼ŒLWP åªæœ‰ä¸€ä¸ªæœ€å°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œè°ƒåº¦ç¨‹åºæ‰€éœ€çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ï¼› çº¿ç¨‹æ˜¯æ¯”è¿›ç¨‹æ›´å°çš„ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ ä¸€ä¸ªç¨‹åºè‡³å°‘å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ª($\u003e=1$)çº¿ç¨‹ è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹æ˜¯èµ„æºï¼ˆåŒ…æ‹¬å†…å­˜ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ï¼‰åˆ†é…çš„å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„å•ä½ï¼› è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„èµ„æºå¹³å°ï¼Œè€Œçº¿ç¨‹åªç‹¬äº«å¿…ä¸å¯å°‘çš„èµ„æºï¼Œå¦‚å¯„å­˜å™¨å’Œæ ˆï¼› åŒä¸€è¿›ç¨‹çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè€Œè¿›ç¨‹ä¹‹é—´åˆ™æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼› åŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«æœ¬åœ°çš„èµ„æºï¼Œä½†æ˜¯è¿›ç¨‹ä¹‹é—´çš„èµ„æºæ˜¯ç‹¬ç«‹çš„ï¼› ä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹å´©æºƒï¼Œå³å¤šè¿›ç¨‹æ¯”å¤šçº¿ç¨‹å¥å£®ï¼› è¿›ç¨‹åˆ‡æ¢ï¼Œæ¶ˆè€—çš„èµ„æºå¤§ï¼ˆä¸»è¦æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ‡æ¢å¼€é”€ï¼‰ï¼Œçº¿ç¨‹åŒæ ·å…·æœ‰å°±ç»ªã€é˜»å¡ã€æ‰§è¡Œä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼ŒåŒæ ·å…·æœ‰çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å…³ç³»ï¼› å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹éƒ½å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œçº¿ç¨‹èƒ½å‡å°‘å¹¶å‘æ‰§è¡Œçš„æ—¶é—´å’Œç©ºé—´å¼€é”€ï¼› æ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ä¸€ä¸ªç¨‹åºå…¥å£ã€ç¨‹åºå‡ºå£ï¼›çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œå¿…é¡»ä¾å­˜äºåº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ï¼› ","date":"2024-05-15","objectID":"/gmp-of-go/:1:2","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"åç¨‹ Co-routine åç¨‹ï¼Œåˆç§° â€œå¾®çº¿ç¨‹â€ï¼Œè¡¨ç°ä¸ºä¸€ä¸ªå¯ä»¥ suspend å’Œ resume çš„å‡½æ•°ã€‚ å®ç°åç¨‹çš„å…³é”®ç‚¹ï¼šåœ¨äºå¦‚ä½•ä¿å­˜ã€æ¢å¤å’Œåˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œåç¨‹åˆ‡æ¢åªæ¶‰åŠåŸºæœ¬çš„CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆCPUå¯„å­˜å™¨ï¼‰. æ‰€æœ‰çš„åç¨‹å…±ç”¨çš„éƒ½æ˜¯ä¸€ä¸ªæ ˆï¼Œå³ç³»ç»Ÿæ ˆï¼Œä¹Ÿå°±ä¹Ÿä¸å¿…æˆ‘ä»¬è‡ªè¡Œå»ç»™åç¨‹åˆ†é…æ ˆï¼Œå› ä¸ºæ˜¯å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬å½“ç„¶ä¹Ÿä¸å¿…å»æ˜¾ç¤ºçš„ä¿å­˜å¯„å­˜å™¨çš„å€¼ï¼› Co-routine åˆ†ç±» æœ‰æ ˆ (stackful) åç¨‹ï¼šå®ç°ç±»ä¼¼äºå†…æ ¸æ€çº¿ç¨‹çš„å®ç°ï¼Œä¸åŒåç¨‹çš„åˆ‡æ¢è¿˜æ˜¯è¦åˆ‡æ¢å¯¹åº”çš„æ ˆä¸Šä¸‹æ–‡ï¼Œåªæ˜¯ä¸ç”¨é™·å…¥å†…æ ¸ï¼Œä¾‹å¦‚ goroutineã€libco æ— æ ˆ (stackless) åç¨‹ï¼šæ— æ ˆåç¨‹çš„ä¸Šä¸‹æ–‡éƒ½ä¼šæ”¾åˆ°å…¬å…±å†…å­˜ä¸­ï¼Œåœ¨åç¨‹åˆ‡æ¢æ—¶ä½¿ç”¨çŠ¶æ€æœºæ¥åˆ‡æ¢ï¼Œè€Œä¸ç”¨åˆ‡æ¢å¯¹åº”çš„ä¸Šä¸‹æ–‡ï¼ˆéƒ½å·²ç»åœ¨å †ä¸­ï¼‰ï¼Œç›¸æ¯”æœ‰æ ˆåç¨‹æ›´è½»é‡ï¼Œä¾‹å¦‚ C++20ã€Rustã€JavaScriptï¼›==æœ¬è´¨å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼ˆstate machineï¼‰ï¼Œå³åŒä¸€åç¨‹åç¨‹çš„åˆ‡æ¢æœ¬è´¨ä¸è¿‡æ˜¯æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨çš„æ”¹å˜== Co-routine ç‰¹ç‚¹ ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªåç¨‹ï¼›åç¨‹ä¸æ˜¯è¢«æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ï¼Œè€Œæ˜¯å®Œå…¨ç”±ç¨‹åºæ§åˆ¶ï¼› åç¨‹çš„å¼€é”€è¿œè¿œå°äºçº¿ç¨‹ï¼›åç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆï¼Œåœ¨è¿›è¡Œåç¨‹è°ƒåº¦æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡æ¢å›æ¥æ—¶æ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆï¼› æ¯ä¸ªåç¨‹è¡¨ç¤ºä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œæœ‰è‡ªå·±çš„æœ¬åœ°æ•°æ®ï¼Œä¸å…¶ä»–åç¨‹å…±äº«å…¨å±€æ•°æ®å’Œå…¶ä»–èµ„æºï¼› è·¨å¹³å°ã€è·¨ä½“ç³»æ¶æ„ã€æ— éœ€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€æ–¹ä¾¿åˆ‡æ¢æ§åˆ¶æµï¼Œç®€åŒ–ç¼–ç¨‹æ¨¡å‹ï¼› åç¨‹çš„æ‰§è¡Œæ•ˆç‡æé«˜ï¼Œå’Œå¤šçº¿ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹æ•°é‡è¶Šå¤šï¼Œåç¨‹çš„æ€§èƒ½ä¼˜åŠ¿è¶Šæ˜æ˜¾ï¼› ","date":"2024-05-15","objectID":"/gmp-of-go/:1:3","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"II. GMP Golang ä¸ºæä¾›æ›´åŠ å®¹æ˜“ä½¿ç”¨çš„å¹¶å‘å·¥å…·ï¼ŒåŸºäº GMP æ¨¡å‹å®ç°äº† goroutine å’Œ channelã€‚ Goroutine å±äº Co-routine çš„æ¦‚å¿µï¼Œéå¸¸è½»é‡ï¼Œä¸€ä¸ª goroutine åˆå§‹ç©ºé—´åªå å‡  KB ä¸”å¯ä¼¸ç¼©ï¼Œä½¿å¾—åœ¨æœ‰é™ç©ºé—´å†…æ”¯æŒå¤§é‡ goroutine å¹¶å‘ã€‚ Channel å¯ä»¥ç‹¬ç«‹åˆ›å»ºå’Œå­˜å–ï¼Œåœ¨ä¸åŒçš„ Goroutine ä¸­ä¼ é€’ä½¿ç”¨ï¼Œä½œä¸ºé˜Ÿåˆ—ï¼Œéµå¾ª FIFO åŸåˆ™ï¼ŒåŒæ—¶ä¿è¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ª goroutine è®¿é—®ã€‚ channel ä½œä¸ºä¸€ç§å¼•ç”¨ç±»å‹ï¼Œå£°æ˜æ—¶éœ€è¦æŒ‡å®šä¼ è¾“æ•°æ®ç±»å‹ï¼Œå£°æ˜å½¢å¼å¦‚ä¸‹(T æ˜¯ channel å¯ä¼ è¾“çš„æ•°æ®ç±»å‹)ï¼š // å£°æ˜ channel var ch chan T // åŒå‘ channel var ch chan\u003c- T // åªèƒ½å‘é€ msg çš„ channel var ch \u003c-chan T // åªèƒ½æ¥æ”¶ msg çš„ channel // åˆ›å»º channel ch := make(chan T, capicity) // åŒå‘ channel ch := make(chan\u003c- T, capicity) // åªèƒ½å‘é€ msg çš„ channel ch := make(\u003c-chan T, capicity) // åªèƒ½æ¥æ”¶ msg çš„ channel // è®¿é—® channel ch \u003c- msg // å‘é€ msg msg := \u003c-ch // æ¥æ”¶ msg msg, ok := \u003c-ch // æ¥æ”¶ msgï¼ŒåŒæ—¶åˆ¤æ–­ channel æ˜¯å¦æ¥æ”¶æˆåŠŸ close(ch) // å…³é—­ channel ","date":"2024-05-15","objectID":"/gmp-of-go/:2:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"Golang è°ƒåº¦ è°ƒåº¦ç»„ä»¶ Gï¼šGoroutineï¼Œä¸€ä¸ªè®¡ç®—ä»»åŠ¡. ç”±éœ€è¦æ‰§è¡Œçš„ä»£ç å’Œå…¶ä¸Šä¸‹æ–‡ç»„æˆï¼Œä¸Šä¸‹æ–‡åŒ…æ‹¬ï¼šå½“å‰ä»£ç ä½ç½®ã€æ ˆç©ºé—´(åˆå§‹2Kï¼Œå¯å¢é•¿)ã€çŠ¶æ€ç­‰ã€‚ Mï¼šMachineï¼Œç³»ç»Ÿçº¿ç¨‹ï¼Œæ‰§è¡Œå®ä½“ã€‚ä¸ C è¯­è¨€ä¸­çš„çº¿ç¨‹ç›¸åŒï¼Œé€šè¿‡ clone åˆ›å»ºã€‚ P: Processorï¼Œè™šæ‹Ÿå¤„ç†å™¨ï¼ŒåŒ…å«äº† G è¿è¡Œæ‰€éœ€çš„èµ„æºï¼Œå› æ­¤ M å¿…é¡»è·å¾— P æ‰èƒ½æ‰§è¡Œä»£ç ï¼Œå¦åˆ™å¿…é¡»é™·å…¥ä¼‘çœ ï¼ˆåå°ç›‘æ§çº¿ç¨‹é™¤å¤–ï¼‰ã€‚å¯ç†è§£ä¸ºä¸€ç§ tokenï¼Œæœ‰è¿™ä¸ª tokenï¼Œæ‰æœ‰åœ¨ç‰©ç† CPU æ ¸å¿ƒä¸Šæ‰§è¡Œçš„æƒé™ã€‚ ç›¸å…³æ•°æ®ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š g çš„æ•°æ®ç»“æ„ï¼š type g struct { // Stack parameters. // stack describes the actual stack memory: [stack.lo, stack.hi). // stackguard0 is the stack pointer compared in the Go stack growth prologue. // It is stack.lo+StackGuard normally, but can be StackPreempt to trigger a preemption. // stackguard1 is the stack pointer compared in the //go:systemstack stack growth prologue. // It is stack.lo+StackGuard on g0 and gsignal stacks. // It is ~0 on other goroutine stacks, to trigger a call to morestackc (and crash). stack stack // offset known to runtime/cgo stackguard0 uintptr // offset known to liblink stackguard1 uintptr // offset known to liblink _panic *_panic // innermost panic - offset known to liblink _defer *_defer // innermost defer m *m // current m; offset known to arm liblink sched gobuf syscallsp uintptr // if status==Gsyscall, syscallsp = sched.sp to use during gc syscallpc uintptr // if status==Gsyscall, syscallpc = sched.pc to use during gc stktopsp uintptr // expected sp at top of stack, to check in traceback // param is a generic pointer parameter field used to pass // values in particular contexts where other storage for the // parameter would be difficult to find. It is currently used // in four ways: // 1. When a channel operation wakes up a blocked goroutine, it sets param to // point to the sudog of the completed blocking operation. // 2. By gcAssistAlloc1 to signal back to its caller that the goroutine completed // the GC cycle. It is unsafe to do so in any other way, because the goroutine's // stack may have moved in the meantime. // 3. By debugCallWrap to pass parameters to a new goroutine because allocating a // closure in the runtime is forbidden. // 4. When a panic is recovered and control returns to the respective frame, // param may point to a savedOpenDeferState. param unsafe.Pointer atomicstatus atomic.Uint32 stackLock uint32 // sigprof/scang lock; TODO: fold in to atomicstatus goid uint64 schedlink guintptr waitsince int64 // approx time when the g become blocked waitreason waitReason // if status==Gwaiting preempt bool // preemption signal, duplicates stackguard0 = stackpreempt preemptStop bool // transition to _Gpreempted on preemption; otherwise, just deschedule preemptShrink bool // shrink stack at synchronous safe point // asyncSafePoint is set if g is stopped at an asynchronous // safe point. This means there are frames on the stack // without precise pointer information. asyncSafePoint bool paniconfault bool // panic (instead of crash) on unexpected fault address gcscandone bool // g has scanned stack; protected by _Gscan bit in status throwsplit bool // must not split stack // activeStackChans indicates that there are unlocked channels // pointing into this goroutine's stack. If true, stack // copying needs to acquire channel locks to protect these // areas of the stack. activeStackChans bool // parkingOnChan indicates that the goroutine is about to // park on a chansend or chanrecv. Used to signal an unsafe point // for stack shrinking. parkingOnChan atomic.Bool // inMarkAssist indicates whether the goroutine is in mark assist. // Used by the execution tracer. inMarkAssist bool coroexit bool // argument to coroswitch_m raceignore int8 // ignore race detection events nocgocallback bool // whether disable callback from C tracking bool // whether we're tracking this G for sched latency statistics trackingSeq uint8 // used to decide whether to track this G trackingStamp int64 // timestamp of when the G last started being tracked runnableTime int64 // the amount of time spent runnable, cleared when running, only used when tracking lockedm muintptr sig uint32 writebuf []byte sigcode0 uintptr sigcode1 uintptr sigpc uintptr parentGoid uint64 // goid of g","date":"2024-05-15","objectID":"/gmp-of-go/:2:1","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"Goroutine åˆ‡æ¢æˆæœ¬ gobuf æè¿°äº†ä¸€ä¸ª Goroutine æ‰€æœ‰ç°åœºï¼Œä»ä¸€ä¸ª g åˆ‡æ¢åˆ°å¦ä¸€ä¸ª gï¼Œåªè¦æŠŠè¿™å‡ ä¸ªç°åœºå­—æ®µä¿å­˜ä¸‹æ¥ï¼Œå†å°† g å…¥é˜Ÿï¼ŒM å°±å¯ä»¥æ‰§è¡Œå…¶ä»– g äº†ï¼Œæ— éœ€è¿›å…¥å†…æ ¸æ€ã€‚ gobuf æ•°æ®ç»“æ„å¦‚ä¸‹ type gobuf struct { // The offsets of sp, pc, and g are known to (hard-coded in) libmach. // // ctxt is unusual with respect to GC: it may be a // heap-allocated funcval, so GC needs to track it, but it // needs to be set and cleared from assembly, where it's // difficult to have write barriers. However, ctxt is really a // saved, live register, and we only ever exchange it between // the real register and the gobuf. Hence, we treat it as a // root during stack scanning, which means assembly that saves // and restores it doesn't need write barriers. It's still // typed as a pointer so that any other writes from Go get // write barriers. sp uintptr pc uintptr g guintptr ctxt unsafe.Pointer ret uintptr lr uintptr bp uintptr // for framepointer-enabled architectures } ","date":"2024-05-15","objectID":"/gmp-of-go/:2:2","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"runtime å¯æ‹¦æˆª goroutine é˜»å¡åœºæ™¯è§£æ Goroutine å±äºåç¨‹çš„ä¸€ç§ï¼Œå› æ­¤å­˜åœ¨è¿è¡Œæ€ã€é˜»å¡æ€ç­‰å„ç§çŠ¶æ€ã€‚ é‚£ä¹ˆ goroutine ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿé˜»å¡ï¼Ÿ å½“ goroutine å‘ç”Ÿé˜»å¡æ—¶ï¼ŒGMP æ¨¡å‹å¦‚ä½•åº”å¯¹ï¼Ÿ æ˜¾ç„¶ï¼Œå½“ goroutine å‘ç”Ÿå¯è¢« runtime æ‹¦æˆªçš„é˜»å¡æ—¶ï¼ŒGMP æ¨¡å‹å¹¶ä¸ä¼šé˜»å¡è°ƒåº¦å¾ªç¯ï¼Œ è€Œæ˜¯æŠŠ goroutine æŒ‚èµ·ï¼Œå³è®© g å…ˆè¿›æŸä¸ªæ•°æ®ç»“æ„ï¼Œå¾… ready ååœ¨ç»§ç»­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå ç”¨çº¿ç¨‹ï¼Œ åŒæ—¶çº¿ç¨‹ä¼šè¿›å…¥ scheduleï¼Œç»§ç»­æ¶ˆè´¹é˜Ÿåˆ—ï¼Œæ‰§è¡Œå…¶ä»–çš„ g. åœºæ™¯ I: å»¶è¿Ÿ package main import ( \"fmt\" \"time\" ) func main() { fmt.Println(\"Before: \", time.Now()) time.Sleep(30 * time.Minute) fmt.Println(\"After: \", time.Now()) } å‡½æ•°è°ƒç”¨é“¾å¦‚ä¸‹ï¼š time.Sleep -\u003e runtime.timeSleep { ... gp := getg() t := gp.timer ... t.arg = gp ... } -\u003e gopark(resetForSleep, unsafe.Pointer(t), waitReasonSleep, traceBlockSleep, 1) æ˜¾ç„¶ï¼Œåœ¨ runtime.timeSleep å‡½æ•°ä¸­ï¼Œè·å–åˆ°çš„å½“å‰ g è¢«æŒ‚åœ¨ runtime.timer.arg ä¸Šï¼Œç„¶åè¢«æŒ‚èµ·ã€‚ åœºæ™¯ II: Channel send / recv (chan / select) package main import ( \"fmt\" \"sync\" \"time\" ) func main() { var ch = make(chan int) var wg = sync.WaitGroup{} wg.Add(2) go func(ch chan\u003c- int) { defer close(ch) defer wg.Done() time.Sleep(time.Second) ch \u003c- 1 }(ch) go func(ch \u003c-chan int) { defer wg.Done() val := \u003c-ch fmt.Println(val) }(ch) wg.Wait() } å‡½æ•° ch\u003c- è°ƒç”¨é“¾å¦‚ä¸‹ï¼š ch\u003c- -\u003e runtime.chansend1 -\u003e runtime.chansend { ... gp := getg() mysg := acquireSudog() ... gp.waiting = mysg gp.param = nil c.sendq.enqueue(mysg) // Signal to anyone trying to shrink our stack that we're about // to park on a channel. The window between when this G's status // changes and when we set gp.activeStackChans is not safe for // stack shrinking. gp.parkingOnChan.Store(true) gopark(chanparkcommit, unsafe.Pointer(\u0026c.lock), waitReasonChanSend, traceBlockChanSend, 2) ... } -\u003e gopark å‡½æ•° ch\u003c- è°ƒç”¨é“¾å¦‚ä¸‹ï¼š \u003c-ch -\u003e runtime.chanrecv1(c *hchan, elem unsafe.Pointer) -\u003e runtime.chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool) { ... // no sender available: block on this channel. gp := getg() mysg := acquireSudog() ... gp.waiting = mysg mysg.g = gp ... c.recvq.enqueue(mysg) // Signal to anyone trying to shrink our stack that we're about // to park on a channel. The window between when this G's status // changes and when we set gp.activeStackChans is not safe for // stack shrinking. gp.parkingOnChan.Store(true) gopark(chanparkcommit, unsafe.Pointer(\u0026c.lock), waitReasonChanReceive, traceBlockChanRecv, 2) } -\u003e runtime.gopark(unlockf func(*g, unsafe.Pointer) bool, lock unsafe.Pointer, reason waitReason, traceReason traceBlockReason, traceskip int) æ ¹æ®è°ƒç”¨é“¾å¯çŸ¥ï¼Œg è¢«å°è£…è¿› sudog ä¸­ï¼Œç„¶åæŒ‚åœ¨äº† hchan.sendq é“¾è¡¨ä¸Šã€‚ ç›¸å…³æ•°æ®ç»“æ„ sudog, sendq å¦‚ä¸‹ï¼š sudog çš„æ•°æ®ç»“æ„ï¼š // sudog (pseudo-g) represents a g in a wait list, such as for sending/receiving // on a channel. // // sudog is necessary because the g â†” synchronization object relation // is many-to-many. A g can be on many wait lists, so there may be // many sudogs for one g; and many gs may be waiting on the same // synchronization object, so there may be many sudogs for one object. // // sudogs are allocated from a special pool. Use acquireSudog and // releaseSudog to allocate and free them. type sudog struct { // The following fields are protected by the hchan.lock of the // channel this sudog is blocking on. shrinkstack depends on // this for sudogs involved in channel ops. g *g next *sudog prev *sudog elem unsafe.Pointer // data element (may point to stack) // The following fields are never accessed concurrently. // For channels, waitlink is only accessed by g. // For semaphores, all fields (including the ones above) // are only accessed when holding a semaRoot lock. acquiretime int64 releasetime int64 ticket uint32 // isSelect indicates g is participating in a select, so // g.selectDone must be CAS'd to win the wake-up race. isSelect bool // success indicates whether communication over channel c // succeeded. It is true if the goroutine was awoken because a // value was delivered over channel c, and false if awoken // because c was closed. success bool // waiters is a count of semaRoot waiting list other than head of list, // clamped to a uint16 to fit in unused space. // Only meaningful at the head of the list. // (If we wanted to be overly clever, we could store a high 16 bits // in the se","date":"2024-05-15","objectID":"/gmp-of-go/:2:3","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"runtime ä¸å¯æ‹¦æˆª goroutine é˜»å¡åœºæ™¯è§£æ time.Sleep / channel send / channel recv / select / net read / net write / sync.Mutex ç­‰é˜»å¡åœºæ™¯å¯è¢« runtime æ‹¦æˆªï¼Œç„¶è€Œä»å­˜åœ¨ä¸€äº›é˜»å¡æƒ…å†µæ˜¯ runtime æ— æ³•æ‹¦æˆªçš„ï¼Œä¾‹å¦‚ï¼šåœ¨æ‰§è¡Œ C ä»£ç æˆ–é˜»å¡åœ¨ syscall ä¸Šæ—¶ï¼Œå¿…é¡»å ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚ ","date":"2024-05-15","objectID":"/gmp-of-go/:2:4","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"III. Sysmon system monitorï¼Œé«˜ä¼˜å…ˆçº§ï¼Œåœ¨ä¸“æœ‰çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸éœ€è¦ç»‘å®š p. ","date":"2024-05-15","objectID":"/gmp-of-go/:3:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"IV. Summary Runtime æ„æˆï¼šSchedulerã€Netpollã€å†…å­˜ç®¡ç†ã€åƒåœ¾å›æ”¶ GMPï¼šM - ä»»åŠ¡æ¶ˆè´¹è€…ï¼›G - è®¡ç®—ä»»åŠ¡ï¼›P - å¯ä»¥ä½¿ç”¨ CPU çš„ token GMP ä¸­çš„é˜Ÿåˆ—æŠ½è±¡ï¼šP çš„æœ¬åœ° runnext å­—æ®µ â€“Â» P çš„ local run queue â€“Â» global run queueï¼›é‡‡ç”¨å¤šçº§é˜Ÿåˆ—å‡å°‘é”ç«äº‰ è°ƒåº¦å¾ªç¯ï¼šçº¿ç¨‹ M åœ¨æŒæœ‰ P çš„æƒ…å†µä¸‹ä¸æ–­æ¶ˆè´¹è¿è¡Œé˜Ÿåˆ—ä¸­çš„ G çš„è¿‡ç¨‹ å¤„ç†é˜»å¡ï¼š runtime å¯ä»¥æ¥ç®¡çš„é˜»å¡ï¼š channel send / recvï¼Œsync.Mutexï¼Œnet read / writeï¼Œselectï¼Œtime.Sleep æ‰€æœ‰ runtime å¯æ¥ç®¡çš„é˜»å¡éƒ½æ˜¯é€šè¿‡ gopark / goparkunlock æŒ‚èµ·ï¼Œgoready æ¢å¤ runtime ä¸å¯æ¥ç®¡çš„é˜»å¡ï¼šsyscallï¼Œcgoï¼Œé•¿æ—¶é—´è¿è¡Œéœ€è¦å‰¥ç¦» P æ‰§è¡Œï¼› sysmonï¼š ä¸€ä¸ªåå°é«˜çº§ä¼˜å…ˆçº§å¾ªç¯ï¼Œæ‰§è¡Œæ—¶ä¸éœ€è¦ç»‘å®šä»»ä½•çš„ P è´Ÿè´£ï¼š æ£€æŸ¥æ˜¯å¦å·²ç»æ²¡æœ‰æ´»åŠ¨çº¿ç¨‹ï¼Œå¦‚æœæ˜¯åˆ™å´©æºƒ è½®è¯¢ netpoll å‰¥ç¦»åœ¨ syscall ä¸Šé˜»å¡çš„ M çš„ P å‘ä¿¡å·ï¼ŒæŠ¢å å·²ç»æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„ G ","date":"2024-05-15","objectID":"/gmp-of-go/:4:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"V. Q \u0026 A ä¸ºä»€ä¹ˆé˜»å¡ç­‰å¾…çš„ goroutineï¼Œæœ‰æ—¶è¡¨ç°ä¸º g æœ‰æ—¶è¡¨ç°ä¸º sudog ï¼Ÿ sudog (pseudo-g) è¡¨ç¤ºç­‰å¾…åˆ—è¡¨ä¸­çš„ gï¼Œä¾‹å¦‚ç”¨äºåœ¨ channel ä¸Šçš„ send/recv. g ä¸åŒæ­¥å¯¹è±¡æ˜¯å¤šå¯¹å¤šçš„å…³ç³»: ä¸€ä¸ª g å¯ä»¥å‡ºç°åœ¨å¤šä¸ªç­‰å¾…åˆ—è¡¨ä¸­ï¼Œå› æ­¤ä¸€ä¸ª g å¯èƒ½æœ‰å¤šä¸ª sudogï¼› å¾ˆå¤š g å¯èƒ½åœ¨ç­‰å¾…åŒä¸€ä¸ªåŒæ­¥å¯¹è±¡ï¼Œå› æ­¤ä¸€ä¸ªå¯¹è±¡å¯èƒ½æœ‰å¾ˆå¤š sudog ä¸€ä¸ª g å¯èƒ½å¯¹åº”å¤šä¸ª sudogï¼Œæ¯”å¦‚ä¸€ä¸ª g ä¼šåŒæ—¶ select å¤šä¸ª channel ","date":"2024-05-15","objectID":"/gmp-of-go/:5:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Golang","GMP","Goroutine","Machine","Process"],"content":"VI. Reference Golangçš„åç¨‹è°ƒåº¦å™¨åŸç†åŠGMPè®¾è®¡æ€æƒ³ Golang ç”Ÿäº§-æ¶ˆè´¹è°ƒåº¦æµç¨‹: Producer Golang ç”Ÿäº§-æ¶ˆè´¹è°ƒåº¦æµç¨‹: Consumer æç«¯æƒ…å†µä¸‹æ”¶ç¼© Go çš„çº¿ç¨‹æ•° Go Scheduler å˜æ›´å² internal/poll/fd_poll_runtime.go internal/poll/fd_unix.go net/fd_unix.go runtime/runtime2.go runtime/time.go runtime/proc.go runtime/netpoll.go runtime/netpoll_epoll.go runtime/sema.go sync/mutex.go time/sleep.go ","date":"2024-05-15","objectID":"/gmp-of-go/:6:0","tags":["Golang","GMP","Goroutine","Machine","Process"],"title":"æ·±å…¥ç†è§£ GMP","uri":"/gmp-of-go/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"æ·±å…¥å‰–æ Golang ç½‘ç»œç¼–ç¨‹ä¹‹ Netpollï¼Œä¸»è¦æ¶‰åŠ Linux ç¯å¢ƒä¸‹çš„ Epoll åˆå§‹åŒ–ã€ Go ç½‘ç»œç¼–ç¨‹åŸºæœ¬æµç¨‹ï¼ˆListenã€Acceptã€Readã€Writeï¼‰ä»¥åŠnetpoll æ‰§è¡Œæµç¨‹ æœ¬æ–‡æ‰€æ¶‰åŠçš„æºç ç‰ˆæœ¬ï¼šv1.22.3 ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:0:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"I. åŸºç¡€æ¦‚å¿µ ç½‘ç»œç¼–ç¨‹ï¼Œæ˜¯å…è®¸ä¸åŒè®¡ç®—æœºä¸Šçš„ç¨‹åºé€šè¿‡ç½‘ç»œé€šä¿¡çš„å¼€å‘è¿‡ç¨‹ï¼Œæ¶‰åŠå¤šç§åè®®ï¼ˆHTTPã€TCP/IPç­‰ï¼‰ä»¥åŠä¸åŒç¼–ç¨‹è¯­è¨€çš„åº”ç”¨ã€‚ ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:1:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"åŒæ­¥ã€å¼‚æ­¥ã€å¹¶å‘æ¨¡å‹ IO æ¨¡å‹ è¯»å†™æ“ä½œå’Œé˜»å¡é˜¶æ®µ é˜»å¡ IO ç¨‹åºé˜»å¡äºè¯»å†™å‡½æ•° IO å¤ç”¨ ç¨‹åºé˜»å¡äº IO å¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œä½†å¯åŒæ—¶ç›‘å¬å¤šä¸ª IO äº‹ä»¶ï¼›å¯¹ IO æœ¬èº«çš„è¯»å†™æ“ä½œæ˜¯éé˜»å¡çš„ SIGIO ä¿¡å· ä¿¡å·è§¦å‘è¯»å†™å°±ç»ªäº‹ä»¶ï¼Œç”¨æˆ·ç¨‹åºæ‰§è¡Œè¯»å†™æ“ä½œï¼›ç¨‹åºæœ¬èº«æ²¡æœ‰é˜»å¡é˜¶æ®µ å¼‚æ­¥ IO å†…æ ¸æ‰§è¡Œè¯»å†™æ“ä½œå¹¶è§¦å‘è¯»å†™å®Œæˆäº‹ä»¶ï¼›ç¨‹åºæ²¡æœ‰é˜»å¡é˜¶æ®µ ä¸»è¦ç”¨äºåŒºåˆ†å†…æ ¸å‘åº”ç”¨ç¨‹åºé€šçŸ¥çš„æ˜¯ä½•ç§ IO äº‹ä»¶ï¼ˆå°±ç»ªäº‹ä»¶ or å®Œæˆäº‹ä»¶ï¼‰ï¼Œä»¥åŠç”±è°æ¥å®Œæˆ IO è¯»å†™ï¼ˆåº”ç”¨ç¨‹åº or å†…æ ¸ï¼‰ IOæ¨¡å‹ä¸­çš„åŒæ­¥ åŒæ­¥ IO æ¨¡å‹ï¼ŒæŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºå‘èµ· IO æ“ä½œåï¼Œå¿…é¡»ç­‰å¾… IO æ“ä½œå®Œæˆåæ‰èƒ½ç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œï¼Œå³ IO æ“ä½œçš„ç»“æœéœ€è¦ç«‹å³è¿”å›ç»™åº”ç”¨ç¨‹åºï¼›åœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ— æ³•åšå…¶ä»–æ“ä½œã€‚ ä¼˜ç‚¹ï¼šç¼–ç¨‹æ¨¡å‹ç®€å• ç¼ºç‚¹ï¼šæ•ˆç‡è¾ƒä½ï¼ˆåº”ç”¨ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦è¢« IO æ“ä½œæ‰€é™åˆ¶ï¼‰ å¯¹äºæ“ä½œç³»ç»Ÿå†…æ ¸æ¥è¯´ï¼ŒåŒæ­¥ IO æ“ä½œæ˜¯æŒ‡åœ¨å†…æ ¸å¤„ç† IO è¯·æ±‚æ—¶éœ€è¦ç­‰å¾… IO æ¨¡å‹ä¸­çš„å¼‚æ­¥ å¼‚æ­¥ IO æ¨¡å‹ï¼ŒæŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºå‘èµ· IO æ“ä½œåï¼Œæ— é¡»ç­‰å¾… IO æ“ä½œå®Œæˆï¼Œå¯ä»¥ç«‹å³è¿›è¡Œåç»­çš„æ“ä½œï¼›åœ¨æ­¤æœŸé—´ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£æŠŠ IO æ“ä½œçš„ç»“æœè¿”å›ç»™åº”ç”¨ç¨‹åºï¼› ä¼˜ç‚¹ï¼šå¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ IO æ“ä½œçš„æ•ˆç‡ ç¼ºç‚¹ï¼šç¼–ç¨‹æ¨¡å‹ç›¸å¯¹å¤æ‚ å¯¹äºæ“ä½œç³»ç»Ÿå†…æ ¸æ¥è¯´ï¼Œå¼‚æ­¥ IO æ“ä½œæŒ‡çš„æ˜¯ï¼Œåœ¨å†…æ ¸å¤„ç† IO è¯·æ±‚æ—¶æ— éœ€ç­‰å¾…ï¼Œç«‹å³è¿”å› å¹¶å‘æ¨¡å¼ å¹¶å‘æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯ I/O å¤„ç†å•å…ƒå’Œå¤šä¸ªé€»è¾‘å•å…ƒä¹‹é—´åè°ƒå®Œæˆä»»åŠ¡çš„æ–¹æ³• ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:1:1","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"Linux Epoll epoll åœ¨å†…æ ¸é‡Œä½¿ç”¨çº¢é»‘æ ‘(Red-black tree)æ¥è·Ÿè¸ªè¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„æ–‡ä»¶æè¿°å­— fdï¼ŒæŠŠéœ€è¦ç›‘æ§çš„ socket é€šè¿‡ epoll_ctl() å‡½æ•°åŠ å…¥å†…æ ¸ä¸­çš„çº¢é»‘æ ‘é‡Œï¼ˆçº¢é»‘æ ‘æ˜¯ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æ”¹ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼‰ epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ï¼Œåœ¨å†…æ ¸é‡Œç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨(List)æ¥è®°å½•å°±ç»ªäº‹ä»¶ã€‚ å½“æŸä¸ª socket æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸é€šè¿‡å›è°ƒå‡½æ•°å°†å…¶åŠ å…¥åˆ°è¿™ä¸ªå°±ç»ªäº‹ä»¶åˆ—è¡¨ä¸­ã€‚ å½“ç”¨æˆ·è°ƒç”¨ epoll_wait() å‡½æ•°æ—¶ï¼Œåªä¼šè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œä¸éœ€è¦åƒ select/poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ª socket é›†åˆï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ ä¸¤ç§è§¦å‘æ¨¡å¼ Level triggerï¼šæœåŠ¡å™¨ç«¯ä¸æ–­åœ°ä» epoll_wait ä¸­è‹é†’ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ•°æ®è¢« read å‡½æ•°è¯»å®Œæ‰ç»“æŸ Edge triggerï¼šæœåŠ¡å™¨ç«¯åªä¼šä» epoll_wait ä¸­è‹é†’ä¸€æ¬¡ äº‹ä»¶å® EPOLLIN è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯è¯»ï¼ˆåŒ…æ‹¬å¯¹ç«¯ socket æ­£å¸¸å…³é—­ï¼‰ EPOLLOUT è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯å†™ EPOLLPRI è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆå¸¦å¤–æ•°æ®ï¼‰ EPOLLERR è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ EPOLLHUP è¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­ EPOLLET å°† EPOLL è®¾ä¸ºè¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼ˆé»˜è®¤ç”µå¹³è§¦å‘ï¼‰ EPOLLONESHOT åªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹åï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ª socket çš„è¯ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ª socket åŠ å…¥åˆ°å†…æ ¸ä¸­çš„äº‹ä»¶æ³¨å†Œè¡¨ä¸­ ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:1:2","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"II. åº”ç”¨ç¤ºä¾‹ package main import \"net\" func main() { l, _ := net.Listen(\"tcp\", \"127.0.0.1:2333\") for { conn, _ := l.Accept() go func() { defer conn.Close() buf := make([]byte, 4096) _, _ = conn.Read(buf) conn.Write(buf) }() } } ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:2:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"III. ç›¸å…³æ•°æ®ç»“æ„ // src/net/fd_fake.go // Network file descriptor. type netFD struct { pfd poll.FD // immutable until Close family int sotype int isConnected bool // handshake completed or use of association with peer net string laddr Addr raddr Addr // The only networking available in WASI preview 1 is the ability to // sock_accept on a pre-opened socket, and then fd_read, fd_write, // fd_close, and sock_shutdown on the resulting connection. We // intercept applicable netFD calls on this instance, and then pass // the remainder of the netFD calls to fakeNetFD. *fakeNetFD } // poll.FD`: `src/internal/poll/fd_unix.go // FD is a file descriptor. The net and os packages use this type as a // field of a larger type representing a network connection or OS file. type FD struct { // Lock sysfd and serialize access to Read and Write methods. fdmu fdMutex // System file descriptor. Immutable until Close. Sysfd int // Platform dependent state of the file descriptor. SysFile // I/O poller. pd pollDesc // Semaphore signaled when file is closed. csema uint32 // Non-zero if this file has been set to blocking mode. isBlocking uint32 // Whether this is a streaming descriptor, as opposed to a // packet-based descriptor like a UDP socket. Immutable. IsStream bool // Whether a zero byte read indicates EOF. This is false for a // message based socket connection. ZeroReadIsEOF bool // Whether this is a file rather than a network socket. isFile bool } // Addr represents a network end point address. // // The two methods [Addr.Network] and [Addr.String] conventionally return strings // that can be passed as the arguments to [Dial], but the exact form // and meaning of the strings is up to the implementation. type Addr interface { Network() string // name of the network (for example, \"tcp\", \"udp\") String() string // string form of address (for example, \"192.0.2.1:25\", \"[2001:db8::1]:80\") } // fdMutex is a specialized synchronization primitive that manages // lifetime of an fd and serializes access to Read, Write and Close // methods on FD. type fdMutex struct { state uint64 rsema uint32 wsema uint32 } type SysFile struct { // Writev cache. iovecs *[]syscall.Iovec } type pollDesc struct { runtimeCtx uintptr } é€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼ŒGolang ç½‘ç»œç¼–ç¨‹æ¶‰åŠåˆ°çš„ netFD, poll.FD, Addr, SysFile ä»¥åŠ pollDesc ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š fdmu æ˜¯ä¸ºäº†ä¿è¯å¯¹åŒä¸€ä¸ªæ–‡ä»¶çš„è¯»ã€å†™æ“ä½œèƒ½åˆ†åˆ«è¢«åºåˆ—åŒ– Sysfd å°±æ˜¯æ“ä½œç³»ç»Ÿä¸­ syscall è¿”å›çš„ fd å€¼ pdï¼ŒpollDesc I/O pollerï¼Œæ˜¯ Go å¯¹ poll è¿‡ç¨‹çš„ä¸€ä¸ªæŠ½è±¡ï¼Œæ‰€æœ‰å¹³å°çš„æŠ½è±¡éƒ½æ˜¯ä¸€æ ·çš„ csemaï¼Œå½“æ–‡ä»¶è¢«å…³é—­æ—¶ä¼šè¢«è§¦å‘ isBlocking è¡¨æ˜ FD æ˜¯å¦ä¸º blocking æ¨¡å¼ IsStream æ ‡å¿—è¯¥ FD æ˜¯å¦æ˜¯æµå¼ï¼Œä¸æµå¼ç›¸åçš„æ˜¯åŸºäº packet çš„ï¼Œå³ UDP socket ZeroReadIsEOFï¼Œå½“è¿æ¥è¯»åˆ° 0 é•¿åº¦æ—¶ï¼Œç”¨æ¥åŒºåˆ†æ˜¯å¦ä»£è¡¨ EOF. å¦‚æœæ˜¯åŸºäº packet çš„ socket è¿æ¥ï¼Œåˆ™å§‹ç»ˆæ˜¯ false isFile æ ‡å¿—è¯¥ FD æ˜¯å¦ä»£è¡¨æ–‡ä»¶ï¼Œè¿˜æ˜¯ç½‘ç»œè¿æ¥ netFD ç»“æ„ä¸­åŒ…å«ä¸€ä¸ª poll.FD ç±»å‹çš„æˆå‘˜ pfdï¼Œä»¥åŠ Addr æ¥å£ç±»å‹çš„ laddr å’Œ raddr poll.FD ç»“æ„å«æœ‰ SysFile å’Œ pollDesc ç±»å‹çš„æˆå‘˜ï¼Œä»¥åŠ fdMutex ç±»å‹çš„ fdmu ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:3:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"IV. TCP ç½‘ç»œç¼–ç¨‹åŸºæœ¬æµç¨‹ æœ¬éƒ¨åˆ†æ¶‰åŠä¼—å¤šå‡½æ•°è°ƒç”¨ï¼Œä¸ºäº†æè¿°æ¸…æ™°ï¼Œé‡‡ç”¨äº†å›¾çš„å½¢å¼ï¼Œå…¶ä¸­ï¼Œæ¯ä¸€å—ç¬¬ä¸€è¡Œè¡¨ç¤ºè¯¥å—æ‰€è¡¨ç¤ºçš„å‡½æ•°åç§°ï¼Œå…¶ä»–éƒ¨åˆ†è¡¨ç¤ºè¯¥å‡½æ•°ä¸­å…³é”®å‡½æ•°è°ƒç”¨ã€‚ ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:4:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"åˆ›å»º TCP socket å¹¶ç›‘å¬: net.Listen NOTE éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰§è¡Œ net.(*netFD).listenStream ä¹‹å‰ï¼Œç”±äº maxListenerBacklog å‡½æ•°è°ƒç”¨äº† open(\"/proc/sys/net/core/somaxconn\")ï¼Œåˆ™ä¼šå¯¼è‡´ epoll åº•å±‚çº¢é»‘æ ‘çš„æå‰åˆ›å»º: runtime.netpollinit -\u003e syscall.EpollCreate1 -\u003e Syscall6(SYS_EPOLL_CREATE1, uintptr(flags), 0, 0, 0, 0, 0). å¦å¤–ï¼Œå½“å¯ç”¨ Timer æ—¶ï¼Œä¹Ÿå­˜åœ¨æå‰åˆå§‹åŒ– netpoll çš„å¯èƒ½ï¼ŒåŸå› ï¼š Timers rely on the network poller time.NewTimer -\u003e runtime.startTimer -\u003e runtime.addtimer -\u003e runtime.doaddtimer -\u003e netpollGenericInit() // doaddtimer adds t to the current P's heap. // The caller must have locked the timers for pp. func doaddtimer(pp *p, t *timer) { // Timers rely on the network poller, so make sure the poller // has started. if netpollInited.Load() == 0 { netpollGenericInit() } ... } ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:4:1","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"è·å– TCP è¿æ¥: net.(*TCPListener).Accept ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:4:2","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"TCP è¿æ¥è¯»æ•°æ®: net.(*TCPConn).Read ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:4:3","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"TCP è¿æ¥å†™æ•°æ®: net.(*TCPConn).Write ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:4:4","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"V. netpoll æ‰§è¡Œæµç¨‹: netpoll åœ¨è°ƒåº¦å’Œ GC çš„å…³é”®ç‚¹ä¸Šéƒ½ä¼šæ£€æŸ¥ä¸€æ¬¡ netpollï¼Œç¡®å®šæ˜¯å¦å­˜åœ¨ ready çŠ¶æ€çš„ FDï¼š startTheWorldWithSema // reason is the same STW reason passed to stopTheWorld. start is the start // time returned by stopTheWorld. // // now is the current time; prefer to pass 0 to capture a fresh timestamp. // // stattTheWorldWithSema returns now. func startTheWorldWithSema(now int64, w worldStop) int64 { assertWorldStopped() mp := acquirem() // disable preemption because it can be holding p in a local var if netpollinited() { list, delta := netpoll(0) // non-blocking injectglist(\u0026list) netpollAdjustWaiters(delta) } lock(\u0026sched.lock) procs := gomaxprocs if newprocs != 0 { procs = newprocs newprocs = 0 } p1 := procresize(procs) sched.gcwaiting.Store(false) if sched.sysmonwait.Load() { sched.sysmonwait.Store(false) notewakeup(\u0026sched.sysmonnote) } unlock(\u0026sched.lock) worldStarted() ... } findrunnable // Finds a runnable goroutine to execute. // Tries to steal from other P's, get g from local or global queue, poll network. // tryWakeP indicates that the returned goroutine is not normal (GC worker, trace // reader) so the caller should try to wake a P. func findRunnable() (gp *g, inheritTime, tryWakeP bool) { ... // Poll network until next timer. if netpollinited() \u0026\u0026 (netpollAnyWaiters() || pollUntil != 0) \u0026\u0026 sched.lastpoll.Swap(0) != 0 { sched.pollUntil.Store(pollUntil) if mp.p != 0 { throw(\"findrunnable: netpoll with p\") } if mp.spinning { throw(\"findrunnable: netpoll with spinning\") } delay := int64(-1) if pollUntil != 0 { if now == 0 { now = nanotime() } delay = pollUntil - now if delay \u003c 0 { delay = 0 } } if faketime != 0 { // When using fake time, just poll. delay = 0 } list, delta := netpoll(delay) // block until new work is available ... } ... } pollWork // pollWork reports whether there is non-background work this P could // be doing. This is a fairly lightweight check to be used for // background work loops, like idle GC. It checks a subset of the // conditions checked by the actual scheduler. func pollWork() bool { if sched.runqsize != 0 { return true } p := getg().m.p.ptr() if !runqempty(p) { return true } if netpollinited() \u0026\u0026 netpollAnyWaiters() \u0026\u0026 sched.lastpoll.Load() != 0 { if list, delta := netpoll(0); !list.empty() { injectglist(\u0026list) netpollAdjustWaiters(delta) return true } } return false } sysmon // Always runs without a P, so write barriers are not allowed. // //go:nowritebarrierrec func sysmon() { ... lock(\u0026sched.sysmonlock) // Update now in case we blocked on sysmonnote or spent a long time // blocked on schedlock or sysmonlock above. now = nanotime() // trigger libc interceptors if needed if *cgo_yield != nil { asmcgocall(*cgo_yield, nil) } // poll network if not polled for more than 10ms lastpoll := sched.lastpoll.Load() if netpollinited() \u0026\u0026 lastpoll != 0 \u0026\u0026 lastpoll+10*1000*1000 \u003c now { sched.lastpoll.CompareAndSwap(lastpoll, now) list, delta := netpoll(0) // non-blocking - returns list of goroutines if !list.empty() { // Need to decrement number of idle locked M's // (pretending that one more is running) before injectglist. // Otherwise it can lead to the following situation: // injectglist grabs all P's but before it starts M's to run the P's, // another M returns from syscall, finishes running its G, // observes that there is no work to do and no other running M's // and reports deadlock. incidlelocked(-1) injectglist(\u0026list) incidlelocked(1) netpollAdjustWaiters(delta) } } ... } æ ¹æ® ready çš„äº‹ä»¶æ—¶ Read æˆ– Writeï¼Œåˆ†åˆ«ä» poolDesc çš„ rgã€wg ä¸Šè·å–è¯¥å”¤é†’çš„ goroutine. ç„¶åå°†å·²ç» ready çš„ goroutine push åˆ° toRun é“¾è¡¨ï¼Œå¹¶ä¸” toRun é“¾è¡¨æœ€ç»ˆä¼šä» netpoll() è¿”å›ï¼Œé€šè¿‡ injectglist è¿›å…¥å…¨å±€é˜Ÿåˆ—. ç›¸å½“äºæ¯æ¬¡è°ƒåº¦å¾ªç¯éƒ½è¦æ‰§è¡Œ netpollï¼Œæ£€æŸ¥é¢‘ç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ // netpoll checks for ready network connections. // Returns list of goroutines that become runnable. // delay \u003c 0: blocks indefinitely // delay == 0: does not block, just polls // delay \u003e 0: block for up to that many nanoseconds func netpoll(delay int64) (gList, int32) { if epfd == -1 { return gList{}, 0 } var waitms int32 if delay \u003c 0 { waitms = -1 } else if ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:5:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"VI. æ€»ç»“ Golang é€šè¿‡å¯¹ Linux å†…æ ¸æä¾›çš„ epoll å®ç°è¿›è¡Œå°è£…ï¼Œå®ç°äº†åŒæ­¥ç¼–ç¨‹å¼‚æ­¥æ‰§è¡Œçš„æ•ˆæœï¼Œå…¶æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯ netFDï¼Œå¹¶å°† Sysfd ä¸ pollDesc ç»“æ„ç»‘å®šã€‚ å½“æŸä¸ª netFD äº§ç”Ÿ EAGAIN é”™è¯¯æ—¶ï¼Œåˆ™å½“å‰ Goroutine å°†ä¼šè¢«å­˜å‚¨åˆ°å…¶å¯¹åº”çš„ pollDesc ä¸­ï¼ŒåŒæ—¶ Goroutine ä¼š gopark()ï¼Œç›´è‡³è¿™ä¸ª netFD å†æ¬¡å‘ç”Ÿè¯»å†™äº‹ä»¶ï¼Œä¼šå°†æ­¤ Goroutine è®¾ç½®ä¸º ready å¹¶æ”¾å…¥ toRun é˜Ÿåˆ—ç­‰å¾…é‡æ–°è¿è¡Œï¼Œè€Œåº•å±‚äº‹ä»¶é€šçŸ¥æœºåˆ¶å°±æ˜¯ epoll. Golang ä¸­ netpoll çš„åˆ›å»ºä¸åˆå§‹åŒ–çš„å¯èƒ½æ¥æºï¼šTimerã€è¯»æ–‡ä»¶ã€TCP Listen. å¦‚ä¸‹çš„è°ƒåº¦å’Œ GC å…³é”®å‡½æ•° startTheWorldWithSemaã€findrunnableã€pollWorkã€sysmon éƒ½ä¼šè¿›è¡Œ netpoll æ‰§è¡Œæµç¨‹ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ ready çŠ¶æ€çš„ FD. ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:6:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Netpoll","Epoll","Network Program","Golang","Linux"],"content":"VII. Reference runtime/netpoll.go runtime/netpoll_epoll.go runtime/proc.go net/fd_unix.go internal/poll/fd_poll_runtime.go internal/poll/fd_unix.go ","date":"2024-05-08","objectID":"/netpoll-of-network-program-for-golang/:7:0","tags":["Netpoll","Epoll","Network Program","Golang","Linux"],"title":"Netpoll of Network Program for Golang","uri":"/netpoll-of-network-program-for-golang/"},{"categories":["Golang","Profile","Optimize"],"content":"Golang å¸¸è§çš„æ€§èƒ½å‰–æ (Profile) ä¸ä¼˜åŒ– (Optimize) ","date":"2024-04-20","objectID":"/go-profile/:0:0","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"I. Profile åœ¨è¿›è¡Œ API å‹æµ‹ã€å…¨é“¾è·¯å‹æµ‹ã€çº¿ä¸Šç”Ÿäº§ç¯å¢ƒè¢«é«˜å³°æµé‡æ‰“çˆ†çš„è¿‡ç¨‹ä¸­éšæ—¶å¯èƒ½å‘ç”Ÿæ•…éšœç­‰é—®é¢˜ï¼Œä¾‹å¦‚ï¼š CPU å ç”¨è¿‡é«˜ï¼Œè¶…è¿‡ 90%ï¼› å†…å­˜çˆ†æ‰ï¼ŒOOM(Out of memory)ï¼› Goroutine æ•°é‡è¿‡å¤šï¼Œ80Wï¼› çº¿ç¨‹æ•°è¶…é«˜ï¼› å»¶è¿Ÿè¿‡é«˜ï¼› åœ¨å‘ç”Ÿä»¥ä¸Šæ•…éšœæ—¶ï¼Œä¸€èˆ¬éœ€è¦ç»“åˆ pprof å¯»æ‰¾æ•…éšœåŸå› ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æƒ…å†µé€‰æ‹©ä¸åŒçš„æ–¹æ¡ˆï¼› çº¿ä¸Šä¸€å®šè¦å…·æœ‰å¼€å¯ pprof çš„èƒ½åŠ›ï¼Œå¦‚æœè€ƒè™‘å®‰å…¨æ€§ï¼Œä¹Ÿè¦å…·æœ‰é€šè¿‡é…ç½®å¼€å¯çš„èƒ½åŠ›ï¼› ","date":"2024-04-20","objectID":"/go-profile/:1:0","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"å‹æµ‹æ—¶éœ€è¦å…³æ³¨çš„æœåŠ¡æŒ‡æ ‡ Request rate: The number of service requests per second. Errors: The number of request that failed. Duration: The time for requests to complete. Goroutine / Thread æ•°é‡: å¦‚æœ Goroutine æ•°é‡å¾ˆå¤šï¼Œéœ€è¦å…³æ³¨è¿™äº› Goroutine çš„æ‰§è¡Œæƒ…å†µ. GC é¢‘ç‡ gctrace çš„å†…å®¹: GC çš„ STW æ—¶é—´ è¿˜æœ‰ä¸€äº›å…¶ä»– Memstats ç›¸å…³çš„å…¶ä»–æŒ‡æ ‡ï¼Œå¯ä»¥å‚è€ƒ Prometheus. ","date":"2024-04-20","objectID":"/go-profile/:1:1","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"å‹æµ‹æ‰‹æ®µ wrk: a HTTP benchmarking tool wrk2: a HTTP benchmarking tool based mostly on wrk HEY: a tiny program that sends some load to a web application. Vegate: a versatile HTTP load testing tool built out of a need to drill HTTP services with a constant request rate. h2load: HTTP/2 benchmarking tool ghz: gRPC benchmarking and load testing tool ","date":"2024-04-20","objectID":"/go-profile/:1:2","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"pprof åº”ç”¨å®ä¾‹ package main import ( \"net/http\" _ \"net/http/pprof\" ) var quit chan struct{} = make(chan struct{}) func f() { \u003c- quit } func main() { go func() { http.ListenAndServe(\":8080\", nil) }() for i := 0; i \u003c 10000; i++ { go f() } for {} // Test } go tool pprof -http=:9999 localhost:8080/debug/pprof/heap æ³¨æ„äº‹é¡¹ æµ‹è¯•ä»£ç ä¸­å¼•å…¥ net/http/pprof åŒ…ï¼š _ \"net/http/pprof\" å•ç‹¬å¯åŠ¨ä¸€ä¸ª Goroutine å¼€å¯ç›‘å¬(ç«¯å£è‡ªå®šï¼Œä¾‹å¦‚è¿™é‡Œæ˜¯ 8080)ï¼šgo func() { http.ListenAndServe(\":8080\", nil) }() $ go tool pprof -http=:9999 localhost:8080/debug/pprof/heap ","date":"2024-04-20","objectID":"/go-profile/:1:3","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"II. Optimize ","date":"2024-04-20","objectID":"/go-profile/:2:0","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"ä¼˜åŒ–æ–¹å‘ åœ¨åˆ†æä¸Šå›¾çš„åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥å‘ç°è¿›è¡Œç¨‹åºä¼˜åŒ–æ—¶ï¼Œä¸€èˆ¬ä»å¯ä»¥ä»ä»¥ä¸‹æ–¹é¢å…¥æ‰‹ï¼š åº”ç”¨å±‚ä¼˜åŒ–: ä¸»è¦æŒ‡çš„æ˜¯é€»è¾‘ä¼˜åŒ–ã€å†…å­˜ä½¿ç”¨ä¼˜åŒ–ã€CPU ä½¿ç”¨ä¼˜åŒ–ã€é˜»å¡ä¼˜åŒ–ç­‰ï¼Œå¹¶ä¸”æœ¬å±‚ä¼˜åŒ–æ•ˆæœå¯èƒ½ä¼˜äºåº•å±‚ä¼˜åŒ–ï¼› åº•å±‚ä¼˜åŒ–ï¼šGCä¼˜åŒ–ã€Go æ ‡å‡†åº“ä¼˜åŒ–ã€Go runtime ä¼˜åŒ–ç­‰ ","date":"2024-04-20","objectID":"/go-profile/:2:1","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"åŸºæœ¬ä¼˜åŒ–æµç¨‹ å¤–éƒ¨ä¾èµ–ï¼šåœ¨ç›‘æ§ç³»ç»Ÿä¸­æŸ¥çœ‹æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œä¾‹å¦‚ä¾èµ–çš„ä¸Šæ¸¸æœåŠ¡ (DB/redis/MQ) å»¶è¿Ÿè¿‡é«˜ï¼› CPU å ç”¨ï¼šé€šè¿‡æŸ¥çœ‹ CPU profile æ£€æŸ¥æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œä¼˜åŒ–å ç”¨ CPU è¾ƒå¤šçš„éƒ¨åˆ†é€»è¾‘ï¼› å†…å­˜å ç”¨ï¼šçœ‹ Prometheusï¼Œå†…å­˜ RSS / Goroutine æ•°é‡ / Goroutine æ ˆå ç”¨ â€“Â» å¦‚æœ Goroutine æ•°é‡ä¸å¤šï¼Œåˆ™é‡ç‚¹å…³æ³¨ heap profile ä¸­çš„ inuse â€“Â» å®šæ—¶ä»»åŠ¡ç±»éœ€è¦çœ‹ alloc Goroutine æ•°é‡è¿‡å¤š â€“Â» ä» profile ç½‘é¡µè¿›å»çœ‹çœ‹ Goroutine çš„æ‰§è¡Œæƒ…å†µï¼ˆåœ¨å¹²ä»€ä¹ˆï¼Ÿï¼‰ â€“Â» æ£€æŸ¥æ­»é”ã€é˜»å¡ç­‰é—®é¢˜ â€“Â» ä¸ªåˆ«ä¸åœ¨æ„å»¶è¿Ÿçš„é€‰æ‹©ç¬¬ä¸‰æ–¹åº“ä¼˜åŒ– ","date":"2024-04-20","objectID":"/go-profile/:2:2","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"å¸¸è§ä¼˜åŒ–åœºæ™¯ å­—ç¬¦ä¸²æ‹¼æ¥ package main import ( \"fmt\" \"testing\" ) func BenchmarkConcat0(b *testing.B) { var str string for i := 0; i \u003c b.N; i++ { str = \"\" str += \"userid : \" + \"1\" str += \"localtion : \" + \"ab\" } } func BenchmarkConcat1(b *testing.B) { var str string for i := 0; i \u003c b.N; i++ { str = \"\" str += fmt.Sprintf(\"userid : %v\", \"1\") str += fmt.Sprintf(\"localtion : %v\", \"ab\") } } $ go test -bench=. -benchmem goos: linux goarch: amd64 pkg: github.com/lutianen/go-test/bench0 cpu: 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz BenchmarkConcat0-16 35702518 32.86 ns/op 24 B/op 1 allocs/op BenchmarkConcat1-16 8105732 140.9 ns/op 56 B/op 3 allocs/op PASS ok github.com/lutianen/go-test/bench0 2.506s é€ƒé€¸åˆ†æ ç”¨æˆ·å£°æ˜çš„å¯¹è±¡ï¼Œè¢«æ”¾åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šï¼Ÿ å¯ä»¥é€šè¿‡ç¼–è¯‘å™¨çš„ escape analysis æ¥å†³å®š go build -gcflags=\"-m\" xxx.go package main func main() { var sl = make([]int, 1024) println(sl[0]) var sl0 = make([]int, 10240) println(sl0[0]) } $ go build -gcflags=\"-m\" main.go # command-line-arguments ./main.go:3:6: can inline main ./main.go:4:15: make([]int, 1024) does not escape ./main.go:7:16: make([]int, 10240) escapes to heap TODO: å„ç§é€ƒé€¸åˆ†æçš„å¯èƒ½æ€§æœ‰å“ªäº›ï¼Ÿ Trasval 2-D Matrix package bench1 import \"testing\" func BenchmarkHorizontal(b *testing.B) { arrLen := 10000 arr := make([][]int, arrLen, arrLen) for i := 0; i \u003c arrLen; i++ { arrInternal := make([]int, arrLen) for j := 0; j \u003c arrLen; j++ { arrInternal[j] = 0 } arr[i] = arrInternal } for i := 0; i \u003c b.N; i++ { for x := 0; x \u003c len(arr); x++ { for y := 0; y \u003c len(arr); y++ { arr[x][y] = 1 } } } } func BenchmarkVertical(b *testing.B) { arrLen := 10000 arr := make([][]int, arrLen, arrLen) for i := 0; i \u003c arrLen; i++ { arrInternal := make([]int, arrLen) for j := 0; j \u003c arrLen; j++ { arrInternal[j] = 0 } arr[i] = arrInternal } for i := 0; i \u003c b.N; i++ { for x := 0; x \u003c len(arr); x++ { for y := 0; y \u003c len(arr); y++ { arr[y][x] = 1 } } } } $ go test -bench=. -benchmem goos: linux goarch: amd64 pkg: github.com/lutianen/go-test/bench1 cpu: 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz BenchmarkHorizontal-16 15 71020410 ns/op 54629717 B/op 666 allocs/op BenchmarkVertical-16 1 1059649022 ns/op 819445856 B/op 10002 allocs/op PASS ok github.com/lutianen/go-test/bench1 3.676s Zero Garbage / Allocation Zero Grabage ä¸€èˆ¬æŒ‡çš„æ˜¯é€šè¿‡åˆ©ç”¨ sync.Pool å°†å †åˆ†é…å®Œå…¨æ¶ˆç­çš„ä¼˜åŒ–æŠ€æœ¯ã€‚ ä¾‹å¦‚ï¼Œåœ¨ http router æ¡†æ¶ fasthttp ä¸­åº”ç”¨è¾ƒå¤š. False Sharing CPU è¿è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹æ•°æ®æ˜¯ä¸€ä¸ª cache lineä¸ºå•ä½ï¼Œå½“ä¸¤ä¸ªå˜é‡A/Bæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š åœ¨å†…å­˜ä¸­ç›¸é‚» å¹¶å‘ä¿®æ”¹é¢‘ç¹ é‚£ä¹ˆï¼Œå½“ CPU0 ä¿®æ”¹å˜é‡ A æ—¶ï¼Œä¼šå¯¼è‡´ CPU1 ä¸­çš„å˜é‡ B ç¼“å­˜å¤±æ•ˆã€‚ è§£å†³æ–¹æ³•ï¼Œåœ¨å®šä¹‰æ•°æ®ç»“æ„ä¸­ï¼Œå¡«å……ä¸€äº› padding ç”¨ä»¥æ»¡è¶³è¯¥æ•°æ®ç»“æ„æ­£å¥½æ˜¯ cache line çš„æ•´æ•°å€ï¼› type NoPad struct { x uint64 y uint64 } type WithPad struct { x uint64 _ [6]uint64 y uint64 } æŸ¥çœ‹ cache line å¤§å°ï¼šcat /sys/devices/system/cpu/cpu\u003ccore-num\u003e/cache/index0/coherency_line_size é™ä½å¤–éƒ¨å‘½ä»¤è°ƒç”¨é¢‘æ¬¡ ä¼˜åŒ–å‰ï¼š func f(wr http.ResponseWriter, r *http.Request) { uuid, _ := exec.Command(\"uuidgen\").Output() // Use exec.Command wr.Header()[\"Content-Type\"] = []string{\"application/text\"} io.WriteString(wr, string(uuid)) } ä¼˜åŒ–åï¼š import uuid \"github.com/satori/go.uuid\" func f(wr http.ResponseWriter, r *http.Request) { uuid, _ := uuid.NewV4() // Replace exec.Command with existing library wr.Header()[\"Content-Type\"] = []string{\"application/text\"} io.WriteString(wr, uuid.String()) } æ€»ç»“ï¼š çº¿ä¸Šä½¿ç”¨ exec å‘½ä»¤æ˜¯éå¸¸å±é™©çš„ é‡‡ç”¨ç¬¬ä¸‰æ–¹åº“ä»£æ›¿å¤–éƒ¨å‘½ä»¤ é˜»å¡å¯¼è‡´é«˜å»¶è¿Ÿ é”é˜»å¡ var mtx sync.Mutex var data = map[string]string{ \"hint\": \"hello wold\", } func f(wr http.ResponseWriter, r *http.Request) { mtx.Lock() defer mtx.Unlock() buf := data[\"hint\"] time.Sleep(time.Millisecond * 10) // ä¸´ç•ŒåŒºå†…çš„æ…¢æ“ä½œ wr.Header()[\"Content-Type\"] = []string{\"application/json\"} io.WriteString(wr, buf) } å‡å°ä¸´ç•ŒåŒº - ä¼˜åŒ–åï¼š var mtx sync.Mutex var data = map[string]string{ \"hint\": \"hello wold\", } func f(wr http.ResponseWriter, r *http.Request) { mtx.Lock() buf := data[\"hint\"] mtx.Unlock() time.Sleep(time.Millisecond * 10) // æ…¢æ“ä½œæ”¾ç½®äºä¸´ç•ŒåŒºä¹‹å¤– wr.Header()[\"Content-Type\"] = []string{\"application/json\"} io.WriteString(wr, buf) } åœ¨åç«¯ç³»ç»Ÿå¼€å‘ä¸­ï¼Œé”ç“¶é¢ˆæ˜¯è¾ƒå¸¸è§çš„é—®é¢˜ï¼Œä¾‹å¦‚æ–‡ä»¶é” åŒ Buffer å®Œå…¨å¹²æ‰é”é˜»å¡ ä½¿ç”¨åŒ Buffer / RCU å®Œå…¨æ¶ˆé™¤è¯»é˜»å¡ï¼šå…¨é‡æ›´æ–°ï¼Œç›´æ¥æ›¿æ¢åŸ config func updateConfig() { var newConfig = \u0026MyConfig { WhiteList: make(map[int]struct{}), } // Do a lot of compulation ","date":"2024-04-20","objectID":"/go-profile/:2:3","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"III. Coutinuous Profiling å‹æµ‹æ˜¯ä¸€ä¸ªè¹²ç‚¹è¡Œä¸ºï¼Œç„¶è€ŒçœŸå®åœºæ™¯å¹¶ä¸ç¾å¥½ï¼Œå®ƒä»¬é€šå¸¸æ˜¯éš¾ä»¥å‘ç°çš„å¶å‘é—®é¢˜ï¼š è¯¥åˆ°åƒé¥­çš„æ—¶å€™ï¼ŒCPU ä½¿ç”¨å°–åˆº å‡Œæ™¨å››ç‚¹åŠï¼Œç³»ç»Ÿå‘ç”Ÿ OOM åˆšç¡ç€çš„æ—¶å€™ï¼ŒGoroutine æ•°é‡çˆ†ç‚¸ äº§å“è¢«éƒ¨ç½²åˆ°å®¢æˆ·é‚£é‡Œï¼Œæƒ³ç™»é™†å®¢æˆ·çš„ç¯å¢ƒå¹¶ä¸æ–¹ä¾¿ æ­¤æ—¶ Coutinuout Profiling å°±æ´¾ä¸Šç”¨åœºäº†. è‡ªçœå¼çš„ Profile Dumperï¼Œå¯ä»¥æ ¹æ® CPU åˆ©ç”¨ç‡ã€Memory åˆ©ç”¨ç‡ã€Goroutine æ•°é‡ç­‰å¤šä¸ªæŒ‡æ ‡æ£€æµ‹ç³»ç»Ÿï¼Œè®¾ç½®å®šæ—¶å‘¨æœŸè¿›è¡Œæ£€æµ‹ï¼Œå½“å‘ç°æŸä¸ªæŒ‡æ ‡å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨ Dump file. ","date":"2024-04-20","objectID":"/go-profile/:3:0","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"IV. Summary _pad ä¼˜åŒ–ï¼Œé’ˆå¯¹å¤šä¸ªçº¿ç¨‹æ›´æ–°åŒä¸€ä¸ªç»“æ„ä½“å†…ä¸åŒçš„å­—æ®µåœºæ™¯æœ‰æ•ˆï¼Œè€Œé’ˆå¯¹ä¸€ä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°æ•´ä¸ªç»“æ„ä½“çš„åœºæ™¯æ„ä¹‰ä¸å¤§ï¼› ç¬¬ä¸‰æ–¹æ¥å£å‡ºç°é—®é¢˜ï¼Œå¦‚ä½•ä¿æŠ¤è‡ªå·±çš„æœåŠ¡ï¼Ÿ å¯¹å¤–éƒ¨è°ƒç”¨å¿…é¡»æœ‰è¶…æ—¶ ==\u003e ç†”æ–­ goroutine åˆå§‹åŒ–æ ˆç©ºé—´ä¸º 2KBï¼Œæœ€å¤§ 1GBï¼Œé‚£ä¹ˆ heap ä¸ºä»€ä¹ˆä¸çˆ†æ ˆï¼Ÿ åœ¨ Go è¯­è¨€ä¸­ï¼Œgoroutine å’Œ heap ä½¿ç”¨å•ç‹¬çš„å†…å­˜ç©ºé—´ï¼šGoroutine æœ‰è‡ªå·±çš„å †æ ˆç©ºé—´ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€å‡½æ•°å¸§å’Œå…¶ä»–è¿è¡Œæ—¶ä¿¡æ¯ï¼›heap åˆ™æ˜¯ä¸€ä¸ªå…±äº«å†…å­˜ç©ºé—´ï¼Œç”¨äºå­˜å‚¨åŠ¨æ€åˆ†é…çš„å¯¹è±¡ï¼Œä¾‹å¦‚ sliceã€map å’Œ stringsã€‚ å½“ Goroutine éœ€è¦åˆ†é…çš„å†…å­˜å¤šäºèµ·å †æ ˆä¸Šçš„å¯ç”¨å†…å­˜æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨ä» stack ä¸­åˆ†é…å†…å­˜ï¼Œé‡‡ç”¨çš„æ˜¯ stack åˆ†é…æœºåˆ¶å®Œæˆï¼Œè¿è¡Œ goroutine åˆ†é…ä»»ä½•æ•°é‡çš„å†…å­˜ï¼Œè€Œä¸ç”¨æ‹…å¿ƒ stack ç©ºé—´è€—å°½ï¼› é™¤äº†å †åˆ†é…ä¹‹å¤–ï¼Œgoroutine è¿˜å¯ä»¥ä½¿ç”¨ä¸€ç§ç§°ä¸ºå †æ ˆå¤åˆ¶çš„æŠ€æœ¯æ¥åœ¨å®ƒä»¬ä¹‹é—´å…±äº«æ•°æ®ï¼Œå †æ ˆå¤åˆ¶æ¯”å †åˆ†é…æ›´æœ‰æ•ˆï¼Œä½†å®ƒåªèƒ½ç”¨äºå…±äº«è¶³å¤Ÿå°ä»¥é€‚åˆå †æ ˆçš„æ•°æ®ã€‚ ","date":"2024-04-20","objectID":"/go-profile/:4:0","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Profile","Optimize"],"content":"V. Reference Benchmarks Game Go Web Frame Benchmarks Go HTTP Router Benchmark Web åœºæ™¯è·¨è¯­è¨€æ€§èƒ½å¯¹æ¯” ã€ŠSystems Performanceã€‹ Dave åˆ†äº«çš„ High Performance Go Workshop go-perfbook: best practices for writing high-performance Go code Delve What is Continuous Profiling? Google-Wide Profiling: A Continuous Profiling Infrastructure for Data Centers ","date":"2024-04-20","objectID":"/go-profile/:5:0","tags":["Golang","Profile","Optimize"],"title":"Profile and Optimize for Go","uri":"/go-profile/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"å„ç§æµè¡Œçš„ Go Linter ä»‹ç»ï¼Œä¾‹å¦‚ Gocycloã€bodycloseã€sqlrowsã€GolangCI-Lintã€reviewdogç­‰ ","date":"2024-04-19","objectID":"/linter-go/:0:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"ä¸€ã€ Gocyclo Gocycloï¼Œå‡½æ•°åœˆå¤æ‚åº¦(cyclomatic complexities)è®¡ç®—å·¥å…·ï¼Œè®¡ç®—æ–¹æ³•ï¼š 1 is the base complexity of a function +1 for each if, for, case, \u0026\u0026 or || NOTE åœ¨ Go è¯­è¨€ä¸­ï¼Œç”±äº if err != nil çš„ç‰¹æ®Šæƒ…å†µå­˜åœ¨ï¼Œå› æ­¤ï¼Œå½“åœˆå¤æ‚åº¦è¶…è¿‡ 15 æ—¶ï¼Œåˆ™è¡¨æ˜å‡½æ•°è¾ƒå¤æ‚ï¼› å…¶ä»–è¯­è¨€ä¸­åœˆå¤æ‚åº¦é˜ˆå€¼ä¸€èˆ¬è®¾ç½®ä¸º 10ï¼› switch ä¸­çš„ default å¹¶ä¸ä¼šå¢åŠ å‡½æ•°çš„åœˆå¤æ‚åº¦ï¼› ","date":"2024-04-19","objectID":"/linter-go/:1:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Install gocyclo commond tool go install github.com/fzipp/gocyclo/cmd/gocyclo@latest ","date":"2024-04-19","objectID":"/linter-go/:1:1","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Usage Calculate cyclomatic complexities of Go functions. Usage: gocyclo [flags] \u003cGo file or directory\u003e ... Flags: -over N show functions with complexity \u003e N only and return exit code 1 if the set is non-empty -top N show the top N most complex functions only -avg, -avg-short show the average complexity over all functions; the short option prints the value without a label -ignore REGEX exclude files matching the given regular expression The output fields for each line are: \u003ccomplexity\u003e \u003cpackage\u003e \u003cfunction\u003e \u003cfile:line:column\u003e ","date":"2024-04-19","objectID":"/linter-go/:1:2","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Example package main import ( \"fmt\" \"strconv\" ) func main() { var a = 10 if a == 10 { f() } else { fmt.Printf(\"%s\", strconv.Itoa(a)) } switch a{ case 10: fmt.Println(a) default: fmt.Println(\"default\") } } func f() { a := 10 b := 12 if a != b { // do something fmt.Println(\"a != b\") } } $ gocyclo gocyclo-test/main.go 3 main main gocyclo-test/main.go:8:1 2 main f gocyclo-test/main.go:24:1 ","date":"2024-04-19","objectID":"/linter-go/:1:3","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"äºŒã€bodyclose bodyclose æ˜¯æ£€æŸ¥ res.Body æ˜¯å¦è¢«æ­£ç¡®å…³é—­çš„é™æ€æ£€æŸ¥å·¥å…·ï¼› ","date":"2024-04-19","objectID":"/linter-go/:2:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Install go install github.com/timakin/bodyclose ","date":"2024-04-19","objectID":"/linter-go/:2:1","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Usage è¿™é‡Œå€Ÿç”¨ GolangCI-Linter çš„æ–¹å¼ä½¿ç”¨ bodyclose package Kyden import ( \"fmt\" \"io\" \"net/http\" ) func f() error{ resp, err := http.Get(\"http://example.com/\") if err != nil { return err } // defer resp.Body.Close() body, err := io.ReadAll(resp.Body) fmt.Println(body) return nil } $ golangci-lint run --disable-all -E bodyclose main.go main.go:10:26: response body must be closed (bodyclose) resp, err := http.Get(\"http://example.com/\") Tip: é¿å…ä½¿ç”¨ http åº“ä¸­ body å¿˜è®° close çš„æ›´ä¼˜æ–¹æ¡ˆæ˜¯ï¼šå¯¹ Go å®˜æ–¹æä¾›çš„ http è¿›è¡Œå°è£…ï¼Œä½¿ caller ä¸ç”¨æ˜¾ç¤ºè°ƒç”¨ close å‡½æ•°. ","date":"2024-04-19","objectID":"/linter-go/:2:2","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"ä¸‰ã€sqlrows sqlrows is a static code analyzer which helps uncover bugs by reporting a diagnostic for mistakes of sql.Rows usage. ","date":"2024-04-19","objectID":"/linter-go/:3:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Install go install github.com/gostaticanalysis/sqlrows ","date":"2024-04-19","objectID":"/linter-go/:3:1","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Usage package sqlrowstest_test import ( \"context\" \"database/sql\" ) func f(ctx context.Context, db *sql.DB) (interface{}, error) { rows, err := db.QueryContext(ctx, \"SELECT * FROM users\") defer rows.Close() if err != nil { return nil, err } // defer rows.Close() for rows.Next() { err = rows.Scan() if err != nil { return nil, err } } return nil, nil } go vet -vettool=$(which sqlrows) main.go (base) # command-line-arguments ./main.go:10:11: using rows before checking for errors go vet -vettool=$(which sqlrows) main.go (base) # command-line-arguments ./main.go:9:33: rows.Close must be called ","date":"2024-04-19","objectID":"/linter-go/:3:2","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"å››ã€GolangCI-Lint golangci-lint is a fast Go linters runner. It runs linters in parallel, uses caching, supports YAML configuration, integrates with all major IDEs, and includes over a hundred linters. ç”Ÿäº§çº§é™æ€åˆ†æå·¥å…· ","date":"2024-04-19","objectID":"/linter-go/:4:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"æœ¬åœ°å®‰è£… # binary will be $(go env GOPATH)/bin/golangci-lint # curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.57.2 # æ³¨æ„ç‰ˆæœ¬ï¼š`v1.57.2` go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest golangci-lint --version ","date":"2024-04-19","objectID":"/linter-go/:4:1","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Usage åœ¨ä¸è¿›è¡Œä»»ä½•é…ç½®çš„æƒ…å†µä¸‹ï¼ŒGolangCI-Lint å°†é»˜è®¤é‡‡ç”¨å¯åŠ¨ä»¥ä¸‹ Linters: errcheck, gosimple, govet, ineffassign, staticcheck, unused è¿˜å¯ä»¥é€šè¿‡ä¼ é€’ -E/--enable å‚æ•°æ¥å¯åŠ¨ Linterï¼Œä¼ é€’ -D/--disable æ¥ç¦ç”¨ Linter golangci-lint run --disable-all -E errcheck ","date":"2024-04-19","objectID":"/linter-go/:4:2","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"Visual Studio Code é›†æˆ VSCodeé…ç½® settings.json \"go.lintTool\": \"golangci-lint\", \"go.lintFlags\": [ \"--fast\" // Using it in an editor without --fast can freeze your editor. ] Golangci-lint automatically discovers .golangci.yml config for edited file: Donâ€™t need to configure it in VS Code settings. æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ ","date":"2024-04-19","objectID":"/linter-go/:4:3","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"äº”ã€reviewdog A code review dog who keeps your codebase healthy. å°†å¸¸ç”¨çš„ Linter é›†æˆåœ¨ CI ä¸Šçº¿æµç¨‹ä¸­ï¼Œå¯ä»¥ä¿è¯é¡¹ç›®ä»£ç è´¨é‡çš„ä¸‹é™ ","date":"2024-04-19","objectID":"/linter-go/:5:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Golang","Linter","Static Check","CI/CD"],"content":"å…­ã€Reference Cyclomatic complexity Gocyclo bodyclose sqlrows GolangCI-Lint static analysis reviewdog ","date":"2024-04-19","objectID":"/linter-go/:6:0","tags":["Golang","Linter","Static Check","CI/CD"],"title":"Linter for Go","uri":"/linter-go/"},{"categories":["Typora","Theme","Markdown","Software"],"content":"åˆ†äº«ä¸€ä¸ªå¥½çœ‹çš„ Typora ä¸»é¢˜ ","date":"2024-04-18","objectID":"/typora-theme/:0:0","tags":["Typora","Theme","Markdown","Software"],"title":"Typora Theme","uri":"/typora-theme/"},{"categories":["Typora","Theme","Markdown","Software"],"content":"æ•ˆæœ æœ¬ Typora è½¯ä»¶ä¸»é¢˜æ˜¯åœ¨ Purple ä¹‹ä¸Šä¿®æ”¹è€Œæ¥ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š ","date":"2024-04-18","objectID":"/typora-theme/:1:0","tags":["Typora","Theme","Markdown","Software"],"title":"Typora Theme","uri":"/typora-theme/"},{"categories":["Typora","Theme","Markdown","Software"],"content":"Source ç”±äºå®ç°æºç å¤ªé•¿ï¼Œç»™å‡ºä¸‹è½½è¿æ¥ï¼šKyden.css ","date":"2024-04-18","objectID":"/typora-theme/:2:0","tags":["Typora","Theme","Markdown","Software"],"title":"Typora Theme","uri":"/typora-theme/"},{"categories":["Typora","Theme","Markdown","Software"],"content":"Reference Typora Purple ","date":"2024-04-18","objectID":"/typora-theme/:3:0","tags":["Typora","Theme","Markdown","Software"],"title":"Typora Theme","uri":"/typora-theme/"},{"categories":[],"content":"Kyden èµ·æº å¥¥åœ°åˆ©å¿ƒç†å­¦å®¶é˜¿å¾·å‹’æ›¾è¯´ï¼Œå¹¸ç¦çš„äººç”¨ç«¥å¹´æ²»æ„ˆä¸€ç”Ÿï¼Œä¸å¹¸çš„äººç”¨ä¸€ç”Ÿæ²»æ„ˆç«¥å¹´ã€‚ æœ¬äººæ¥è‡ªäºåä¸­åœ°åŒºçš„å°å†œæ‘ï¼Œæ¯‹åº¸ç½®ç–‘æ‹¥æœ‰ä¸€ä¸ªéå¸¸è½»æ¾åŠ æ„‰å¿«çš„ç«¥å¹´ï¼Œè€Œâ€œçº¸é¸¢é£èˆâ€å±äºç«¥å¹´ä¸­çš„è®°å¿†æ·±åˆ»çš„äº‹ç‰©ï¼Œæ•…ä»¥æ­¤ä¸ºä½œä¸ºæ˜µç§°ã€‚ Kyden (çº¸é¸¢é£èˆï¼Œé¸¢èˆ) æ¥è‡ª â€œkiteâ€ å’Œâ€œdanceâ€ ç»„åˆçš„å˜ä½“ â€œKiteDanceâ€ã€‚ ","date":"2024-04-18","objectID":"/about/:1:0","tags":[],"title":"About Kyden (é¸¢èˆ)","uri":"/about/"},{"categories":[],"content":"Special Thanks Thanks to the authors of following resources included in the theme: Hugo LoveIt Gitalk ","date":"2024-04-18","objectID":"/about/:2:0","tags":[],"title":"About Kyden (é¸¢èˆ)","uri":"/about/"},{"categories":["Linux","Software"],"content":"è¯¦ç»†ä»‹ç»æ—¥å¸¸ä½¿ç”¨ Arch Linux æ—¶çš„å„ç§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ Arch å®‰è£…ã€å¸¸ç”¨è½¯ä»¶æ¨èã€ç³»ç»Ÿä¼˜åŒ–ç­‰ ","date":"2024-04-17","objectID":"/archlinuxnote/:0:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"é›¶ã€Install Arch Download Arch Linux ISO archlinux-x86_64.iso U ç›˜ ventoy å‡†å¤‡ ç•¥ é€‰æ‹© Arch Linux install medium (x86_64, UEFI) å¯åŠ¨å®‰è£…ç¯å¢ƒ è¿›å…¥ root@archiso åï¼Œéœ€è¦è®¾ç½®äº’è”ç½‘ï¼Œæ¨èä½¿ç”¨ç½‘çº¿è¿æ¥ æ£€æŸ¥ç½‘ç»œæ¥å£æ˜¯å¦å·²ç»å¯ç”¨ ip link 2: enp0s3: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 ... å°–æ‹¬å·å†…çš„â€œUPâ€ï¼Œè¡¨ç¤ºæ¥å£å·²ç»å¯ç”¨ï¼Œå¦åˆ™ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼šip link set enp0s3 up è¯·ä½¿ç”¨ ping å‘½ä»¤æµ‹è¯•ç½‘ç»œ: ping www.baidu.com æ›´æ–°ç³»ç»Ÿæ—¶é’Ÿ: åœ¨äº’è”ç½‘è¿æ¥ä¹‹åï¼Œsystemd-timesyncd æœåŠ¡å°†è‡ªåŠ¨æ ¡å‡†ç³»ç»Ÿæ—¶é—´ï¼Œä¾¿äºå®‰è£…è½¯ä»¶åŒ…æ—¶éªŒè¯ç­¾å timedatectl åˆ†åŒºè®¾ç½® mkfs.ext4 /dev/nvme1n1p7 #ç”¨ä½œæ ¹åˆ†åŒºï¼ŒæŒ‚è½½åˆ° / # mkfs.fat -F32 /dev/nvme1n1p3 #ç”¨ä½œEFIåˆ†åŒº ï¼ŒæŒ‚è½½åˆ° /boot/efi # å¦‚æœå®‰è£…Windowsæ—¶å·²ç»æœ‰ä¸ªEFIåˆ†åŒºï¼Œå°±æŠŠä¸Šé¢çš„/dev/sda1æ¢æˆå·²æœ‰çš„EFIåˆ†åŒº mkfs.ext4 /dev/nvme1n1p8 # æŒ‚è½½åˆ° /home ç›®å½• # mount mount /dev/nvme1n1p7 /mnt #æŒ‚è½½æ ¹ç›®å½• mkdir -p /mnt/boot/efi #EFIåˆ†åŒºçš„æŒ‚è½½ç‚¹ mount /dev/nvme1n1p1 /mnt/boot/efi #æŒ‚è½½EFIåˆ†åŒº mount --mkdir /dev/nvme1n1p8 /mnt/home é€‰æ‹©è½¯ä»¶é•œåƒä»“åº“ æ‰‹åŠ¨ä¿®æ”¹/etc/pacman.d/mirrorlist vim /etc/pacman.d/mirrorlist --- Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch --- pacman -Sy archlinuxcn-keyring pacman -Syyu å®‰è£…åŸºç¡€åŒ… pacstrap /mnt bash base base-devel linux linux-headers linux-firmware neovim xsel // fstab genfstab -U -p /mnt \u003e\u003e /mnt/etc/fstab chroot arch-chroot /mnt # æ—¶åŒº ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime hwclock --systohc # hostname vim /etc/hostname --- é”®å…¥ï¼š`arch` --- # è®¾ç½® locale vim /etc/locale.conf --- é”®å…¥ï¼š`LANG_en_US.UTF-8` --- vim /etc/locale.gen --- å–æ¶ˆæ³¨é‡Šï¼š`#en_US.UTF-8 UTF-8` å–æ¶ˆæ³¨é‡Šï¼š`#zh_CN.UTF-8 UTF-8` --- locale-gen # ç½‘ç»œç®¡ç†å™¨ï¼Œè“ç‰™ pacman -S networkmanager bluez bluez-utils pulseaudio-bluetooth alsa-utils pulseaudio pulseaudio-alsa sof-firmware systemctl enable NetworkManager.service systemctl enable bluetooth.service # root password passwd --- é”®å…¥å¯†ç ï¼šxxxxxx --- # ucode cat /proc/cpuinfo | grep \"model name\" pacman -S intel-ucode # amd-ucode # å®‰è£…å¼•å¯¼åŠ è½½ç¨‹åº pacman -S grub efibootmgr os-prober grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB # é…ç½® os-prober vim /etc/default/grub --- å–æ¶ˆæ³¨é‡Š:`GRUB_DISABLE_OS_PROBER=false` --- grub-mkconfig -o /boot/grub/grub.cfg # Create user and usergroup useradd -m -G wheel tianen passwd tianen --- é”®å…¥å¯†ç  --- # ä¿®æ”¹æƒé™ pacman -S sudo man-pages man-db vim /etc/sudoers --- å–æ¶ˆæ³¨é‡Šï¼š`%wheel ALL=(ALL:ALL) ALL` --- su - tianen # KDE sudo pacman -S plasma xorg nvidia dolphin konsole fish noto-fonts-cjk noto-fonts-emoji sudo systemctl enable sddm # reboot exit swapoff /mnt/swapfile umount -R /mnt reboot ","date":"2024-04-17","objectID":"/archlinuxnote/:1:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"ä¸€ã€å†…æ ¸æ›´æ¢ Install The Desired Kernel sudo pacman -S linux-lts linux-lts-headers Editing GRUB Config File sudo vim /etc/default/grub # --- `GRUB_DISABLE_SUBMENU=y` # disables the GRUB submenu, i.e., it enables all the available kernels to be listed on the main GRUB Menu itself instead of the â€œAdvanced option for Arch Linuxâ€ option. `GRUB_DEFAULT=saved` # saves the last kernel used `GRUB_SAVEDEFAULT=true` # makes sure that grub uses the last selected kernel is used as default Re-Generate GRUB Configuration file sudo grub-mkconfig -o /boot/grub/grub.cfg Choose Kernel From GRUB During Boot ","date":"2024-04-17","objectID":"/archlinuxnote/:2:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"äºŒã€Software ","date":"2024-04-17","objectID":"/archlinuxnote/:3:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"Check NetworkManager ping baidu.com systemctl enable NetworkManager ","date":"2024-04-17","objectID":"/archlinuxnote/:3:1","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"pacman é•œåƒä¿®æ”¹ sudo vim /etc/pacman.conf # ---------------- # Misc options Color ParallelDownloads = 5 # --- [multilib] Include = /etc/pacman.d/mirrorlist #--- é”®å…¥ï¼š [archlinuxcn] Server = https://mirrors.utsc.edu.cn/archlinuxcn/$arch #--- sudo pacman -Syyu sudo pacman -S archlinuxcn-keyring ","date":"2024-04-17","objectID":"/archlinuxnote/:3:2","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"å¸¸è§é€šç”¨è½¯ä»¶ sudo pacman -S yay pacman -Sc # æ¸…é™¤è½¯ä»¶ç¼“å­˜ï¼Œå³/var/cache/pacman/pkgç›®å½•ä¸‹çš„æ–‡ä»¶ pacman -Rns package_name pacman -U pacage.tar.zx # ä»æœ¬åœ°æ–‡ä»¶å®‰è£… pactree pacage_name # æ˜¾ç¤ºè½¯ä»¶çš„ä¾èµ–æ ‘ yay -S fish # curl -L https://get.oh-my.fish | fish fish_config # å–æ¶ˆé—®å€™è¯­ set -U fish_greeting \"\" sudo vim /etc/systemd/system/clash.service sudo systemctl daemon-reload sudo systemctl enable clash sudo systemctl start clash sudo systemctl status clash sudo pacman -S obs-studio è¾“å…¥æ³• sudo pacman -S fcitx5 fcitx5-configtool fcitx5-qt fcitx5-gtk fcitx5-chinese-addons fcitx5-material-color fcitx5-pinyin-moegirl fcitx5-pinyin-zhwiki # sudo vim /etc/environment GTK_IM_MODULE=fcitx QT_IM_MODULE=fcitx XMODIFIERS=\\@im=fcitx # ä¸ºäº†è®©ä¸€äº›ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ SDL2 åº“çš„æ¸¸æˆèƒ½æ­£å¸¸ä½¿ç”¨è¾“å…¥æ³• SDL_IM_MODULE=fcitx yay -S clash-verge-rev-bin yay -Sy neofetch google-chrome obs-studio baidunetdisk nutstore-experimental xunlei-bin telegram-desktop gitkraken visual-studio-code-bin typora-free redis net-tools pot-translation translate-shell okular snipaste gwenview kcalc wemeet-bin vlc wget ark shotcut inkscape ninja gnu-netcat tcpdump cmake clang tree python-pip caj2pdf-qt ttf-hack-nerd transmission-gtk gpick speedcrunch drawio-desktop crow-translate zeal yay -S electronic-wechat-uos-bin linuxqq lx-music-desktop gpick: å¯ä»¥ä»æ¡Œé¢ä»»ä½•åœ°æ–¹å–è‰²ï¼Œå¹¶ä¸”å®ƒè¿˜æä¾›ä¸€äº›å…¶å®ƒçš„é«˜çº§ç‰¹æ€§ SpeedCrunch: ä¸€ä¸ªæ¼‚äº®ï¼Œå¼€æºï¼Œé«˜ç²¾åº¦çš„ç§‘å­¦è®¡ç®—å™¨ Snipaste: æˆªå›¾å·¥å…·ï¼Œå¦‚ä¸å¯ç”¨å¯é€‰ç”¨spectacle drawio-desktop: Security-first diagramming for teams crow-translateï¼šç¿»è¯‘å·¥å…· zealï¼šç¦»çº¿æ–‡æ¡£æµè§ˆå™¨ office yay -S wps-office wps-office-mui-zh-cn ttf-wps-fonts ","date":"2024-04-17","objectID":"/archlinuxnote/:3:3","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"è¿œç¨‹å·¥å…· - Remmina $ yay -S remmina freerdp ä½¿ç”¨æ•™ç¨‹ å®‰è£… freerdp æ’ä»¶åï¼Œå¯ä»¥èµ° RDP åè®®è¿œç¨‹ Win10ï¼ˆWin10 ä¸éœ€è¦å…¶ä»–ä»»ä½•è®¾ç½®ï¼‰ ","date":"2024-04-17","objectID":"/archlinuxnote/:3:4","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"Git é…ç½®git è®¾ç½®user.nameå’Œuser.emal git config --global user.name \"KydenLu\" git config --global user.email xxxx@gmail.com # check git config --list ç”Ÿæˆå¯†é’¥ ssh-keygen -t rsa -C 'xxxx@gmail.com' ä¸Šè¿°ä»£ç æ‰§è¡Œå®Œæˆåï¼Œè¦æ±‚å¤šæ¬¡è¾“å…¥å¯†ç ï¼Œè¯·ä¸è¦è¾“å…¥å¯†ç  githubé…ç½® SSH Keys æ‰“å¼€ç”Ÿæˆçš„ Key æ–‡ä»¶ /.ssh/id_rsa.pub å¤åˆ¶å…¨éƒ¨å†…å®¹ï¼Œåœ¨ Key ä¸­ç²˜è´´ Git å¸¸ç”¨å‘½ä»¤ git status git clone git pull git push git commit -m 'commits' or git commit -m 'commits' xxx.fileType git add . or git xxx.fileType git reflog Gitå®ç°ä»æœ¬åœ°æ·»åŠ é¡¹ç›®åˆ°è¿œç¨‹ä»“åº“ Steps: åˆ›å»ºä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ - Create a new repo Create repository åˆ›å»ºå¹¶åˆå§‹åŒ–æœ¬åœ°ä»“åº“ - git init å¯æ·»åŠ å¾…ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“çš„é¡¹ç›®æ–‡ä»¶ è¿œç¨‹ä»“åº“å’Œæœ¬åœ°ä»“åº“å…³è” - git remote add origin git@github.com:lutianen/System4CE7 é¡¹ç›®æ–‡ä»¶æ·»åŠ ã€æäº¤ã€æ¨é€ git add file git commit -m 'commit statements' file git push -u origin master *ç”±äºè¿œç¨‹åº“æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¨é€masteråˆ†æ”¯æ—¶ï¼ŒåŠ ä¸Šäº†-uå‚æ•°ï¼ŒGitä¸ä½†ä¼šæŠŠæœ¬åœ°çš„masteråˆ†æ”¯å†…å®¹æ¨é€çš„è¿œç¨‹æ–°çš„masteråˆ†æ”¯ï¼Œè¿˜ä¼šæŠŠæœ¬åœ°çš„masteråˆ†æ”¯å’Œè¿œç¨‹çš„masteråˆ†æ”¯å…³è”èµ·æ¥ åœ¨ä»¥åçš„æ¨é€æˆ–è€…æ‹‰å–æ—¶å°±å¯ä»¥ç®€åŒ–å‘½ä»¤ ","date":"2024-04-17","objectID":"/archlinuxnote/:3:5","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"Golang # Download and install go sudo pacman -S go # Set environment variable in `.config/fish/config.sh` or `/etc/profile` or `~/.profile` GOROOT /usr/lib/go GOPATH /home/tianen/goProj GOBIN /home/tianen/goProj/bin PATH $GOPATH/bin $GOROOT/bin $GOBIN $PATH GOROOTï¼Œè®¾ç½® Golang çš„å®‰è£…ä½ç½® GOBINï¼Œæ‰§è¡Œ go install åç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½• GOPATHï¼Œå·¥ä½œç›®å½•ï¼Œä¸€èˆ¬è®¾ç½®åˆ°ç”¨æˆ·ç›®å½•ä¸‹ # Go å·¥ä½œç›®å½•ç»“æ„ â”œâ”€â”€ bin # å­˜æ”¾ `go install` å‘½ä»¤ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸”å¯æŠŠ `$GOBIN` è·¯å¾„åŠ å…¥åˆ° `PATH` ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ go å¼€å‘ç”Ÿæˆçš„ç¨‹åº â”œâ”€â”€ pkg # å­˜æ”¾ go ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ â”œâ”€â”€ readme.md â””â”€â”€ src # å­˜æ”¾ go æºç ï¼Œä¸åŒå·¥ç¨‹é¡¹ç›®çš„ä»£ç ä»¥åŒ…ååŒºåˆ† ","date":"2024-04-17","objectID":"/archlinuxnote/:3:6","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"MySQL å¾ˆå¤šlinuxå‘è¡Œç‰ˆéƒ½æ”¾å¼ƒäº†å¯¹mysqlçš„æ”¯æŒï¼ˆåŸå› è‡ªè¡Œç™¾åº¦ï¼‰è½¬è€Œæ”¯æŒmariadbï¼ˆmysqlçš„å¦ä¸€ä¸ªåˆ†æ”¯ï¼‰ï¼ŒArchlinuxå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œmariadbå…·æœ‰å’Œmysqlä¸€æ¨¡ä¸€æ ·çš„æ“ä½œå‘½ä»¤ï¼Œæ‰€ä»¥å®Œå…¨ä¸ç”¨è€ƒè™‘è¿ç§»å…¼å®¹çš„é—®é¢˜ å®‰è£…mariadb: sudo pacman -Sy mariadb é…ç½®mariadbå‘½ä»¤ï¼Œåˆ›å»ºæ•°æ®åº“éƒ½åœ¨/var/lib/mysql/ç›®å½•ä¸‹é¢: sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql å¼€å¯mariadb æœåŠ¡: systemctl start mariadb åˆå§‹åŒ–å¯†ç ï¼ŒæœŸé—´æœ‰è®©ä½ è®¾ç½®å¯†ç çš„é€‰é¡¹ï¼Œè®¾ç½®ä½ è‡ªå·±çš„å¯†ç å°±è¡Œäº†ï¼Œç„¶åæ ¹æ®è‡ªå·±ç†è§£y/nå°±å¯ï¼Œå› ä¸ºå¾ˆå¤šåé¢å¯ä»¥å†ä¿®æ”¹: sudo /usr/bin/mysql_secure_installation ç™»å½•mariadb å’Œmysqlå‘½ä»¤æ˜¯ä¸€æ ·çš„: mysql -u root -p è®¾ç½®å¼€æœºè‡ªå¯åŠ¨æœåŠ¡: systemctl enable mariadb #å¼€æœºè‡ªå¯åŠ¨ ","date":"2024-04-17","objectID":"/archlinuxnote/:3:7","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"you-get å‘½ä»¤è¡Œç¨‹åºï¼Œæä¾›ä¾¿åˆ©çš„æ–¹å¼æ¥ä¸‹è½½ç½‘ç»œä¸Šçš„åª’ä½“ä¿¡æ¯ã€‚ yay -S you-get ä¸‹è½½æµè¡Œç½‘ç«™ä¹‹éŸ³è§†é¢‘ï¼Œä¾‹å¦‚YouTube, Youku, Niconico,ä»¥åŠæ›´å¤š äºæ‚¨å¿ƒä»ªçš„åª’ä½“æ’­æ”¾å™¨ä¸­è§‚çœ‹åœ¨çº¿è§†é¢‘ï¼Œè„±ç¦»æµè§ˆå™¨ä¸å¹¿å‘Š ä¸‹è½½æ‚¨å–œæ¬¢çš„ç½‘é¡µä¸Šçš„å›¾ç‰‡ ä¸‹è½½ä»»ä½•éHTMLå†…å®¹ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ–‡ä»¶ ","date":"2024-04-17","objectID":"/archlinuxnote/:3:8","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"æŒ‚è½½å…¶ä»–ç¡¬ç›˜åˆ†åŒº # Get UUID and TYPE sudo blkid # /dev/nvme1n1p3: LABEL=\"Document\" BLOCK_SIZE=\"512\" UUID=\"111915F1111915F1\" TYPE=\"ntfs\" PARTLABEL=\"Basic data partition\" PARTUUID=\"666266ba-233b-11ed-95be-00e04c3656eb\" # Write UUID TYPE ... sudo vim /etc/fstab # \u003cdevice\u003e \u003cdir\u003e \u003ctype\u003e \u003coptions\u003e \u003cdump\u003e \u003cfsck\u003e UUID=111915F1111915F1 /home/tianen/doc ntfs3 defaults 0 0 \u003cdevice\u003e æè¿°è¦æŒ‚è½½çš„ç‰¹å®šå—è®¾å¤‡æˆ–è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ \u003cdir\u003e æè¿°æŒ‚è½½ç›®å½• \u003ctype\u003e æ–‡ä»¶ç³»ç»Ÿç±»å‹ \u003coptions\u003e ç›¸å…³çš„æŒ‚è½½é€‰é¡¹ \u003cdump\u003e ä¼šè¢« dump(8) å·¥å…·æ£€æŸ¥ã€‚è¯¥å­—æ®µé€šå¸¸è®¾ç½®ä¸º 0, ä»¥ç¦ç”¨æ£€æŸ¥ \u003cfsck\u003e è®¾ç½®å¼•å¯¼æ—¶æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥çš„é¡ºåº; å¯¹äº root è®¾å¤‡è¯¥å­—æ®µåº”è¯¥è®¾ç½®ä¸º 1ã€‚å¯¹äºå…¶å®ƒåˆ†åŒºè¯¥å­—æ®µåº”è¯¥è®¾ç½®ä¸º 2,æˆ–è®¾ç½®ä¸º 0 ä»¥ç¦ç”¨æ£€æŸ¥ æˆ‘ä½¿ç”¨ TYPE ä¸º ntfs æ—¶å¯¼è‡´å¯åŠ¨å¤±è´¥ï¼Œä¿®æ”¹ä¸º ntfs3 åæˆåŠŸæŒ‚è½½ ","date":"2024-04-17","objectID":"/archlinuxnote/:3:9","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"Present Windows ","date":"2024-04-17","objectID":"/archlinuxnote/:3:10","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"scp æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ ä¸Šä¼  scp .\\cifar-10-python.tar.gz lutianen@10.xxx.xxx.xxx:/home/lutianen/ ä¸‹è½½ scp root@10.xxx.xxx.xxx:/var/tmp/a.txt /var ","date":"2024-04-17","objectID":"/archlinuxnote/:3:11","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"picgo picgo-core ã€Recommendã€‘ Download and Install PigGo-Core Get token with GitHub Configure config.json NOTEï¼šWhen using ~/.picgo/config.json, delete the comments to avoid unnecessary troubleï¼ˆä½¿ç”¨æ—¶ï¼Œå°†æ³¨é‡Šåˆ æ‰ï¼Œä»¥å…äº§ç”Ÿä¸å¿…è¦çš„éº»çƒ¦ï¼‰ { \"picBed\": { \"current\": \"github\", \"github\": { \"repo\": \"lutianen/PicBed\", // è®¾å®šä»“åº“åï¼šä¸Šæ–‡åœ¨ GitHub åˆ›å»ºçš„ä»“åº“ `lutianen/PicBed` \"branch\": \"master\", // è®¾å®šåˆ†æ”¯åï¼š`master` \"token\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\", // è®¾å®š Tokenï¼šä¸Šæ–‡ç”Ÿæˆçš„ toke \"path\": \"\", // æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼šä¸ºç©ºçš„è¯ä¼šä¸Šä¼ åˆ°æ ¹ç›®å½•ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè·¯å¾„ \"customUrl\": \"\" // è®¾å®šè‡ªå®šä¹‰åŸŸåï¼šå¯ä»¥ä¸ºç©º }, \"uploader\": \"github\", \"transformer\": \"path\" }, \"picgoPlugins\": { \"picgo-plugin-github-plus\": true } } picgo app ã€Not Recommendã€‘ å®‰è£… picgo: yay -S picgo picgo é…ç½® github github è·å– token: è§ picgo-core é…ç½® PicGo é…ç½® è®¾å®šä»“åº“åï¼šä¸Šæ–‡åœ¨ GitHub åˆ›å»ºçš„ä»“åº“ lutianen/PicBed è®¾å®šåˆ†æ”¯åï¼šmaster è®¾å®š Tokenï¼šä¸Šæ–‡ç”Ÿæˆçš„ token æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼šä¸ºç©ºçš„è¯ä¼šä¸Šä¼ åˆ°è·Ÿç›®å½•ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè·¯å¾„ è®¾å®šè‡ªå®šä¹‰åŸŸåï¼šå¯ä»¥ä¸ºç©ºï¼Œè¿™é‡Œä¸ºäº†ä½¿ç”¨ CDN åŠ å¿«å›¾ç‰‡çš„è®¿é—®é€Ÿåº¦ï¼ŒæŒ‰è¿™æ ·æ ¼å¼å¡«å†™ï¼šhttps://cdn.jsdelivr.net/gh/lutianen/PicBed/@master ","date":"2024-04-17","objectID":"/archlinuxnote/:3:12","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"VirtualBox sudo pacman -S virtualbox # dkms sudo pacman -S virtualbox-host-dkms sudo dkms autoinstall sudo modprobe vboxdrv sudo pacman -S virtualbox-guest-utils sudo systemctl enable vboxservice.service ","date":"2024-04-17","objectID":"/archlinuxnote/:3:13","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"CUDA \u0026 cuDNN yay -S cuda-11.7 cudnn8-cuda11.0 Arch Linux ä¼šå°† CUDA ç›¸å…³æ¡£æ¡ˆå®‰è£…è‡³ /opt/cudaï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å°† CUDA çš„ PATH åŠ åˆ° ~/bashrcï¼Œæ­¤è·¯å¾„æ°¸è¿œæŒ‡å‘æœ€æ–°ç‰ˆCUDA # cuda # fish set PATH /opt/cuda-11.7/bin $PATH set LD_LIBRARY_PATH /opt/cuda-11.7/lib64/ $PATH pip install torch==1.13.1+cu117 torchvision==0.14.1+cu117 torchaudio==0.13.1 --extra-index-url https://download.pytorch.org/whl/cu117 ","date":"2024-04-17","objectID":"/archlinuxnote/:3:14","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"wireguard # Install wg sudo pacman -S wireguard-tools # Open wg sudo wg-quick up wg0 # Close wg sudo wg-quick down wg0 wg0.conf /etc/wireguard/wg0.conf [Interface] PrivateKey = xxxxxxxxxxxxxxxxxxx Address = 172.16.0.2/32 Address = 2606:4700:110:8fe8:bc78:d25a:896a:9696/128 DNS = 1.1.1.1 MTU = 1280 [Peer] PublicKey = bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo= AllowedIPs = 0.0.0.0/0 AllowedIPs = ::/0 Endpoint = xxx.xxx.xxx.xxx é…ç½®æ­¥éª¤å¦‚ä¸‹ # Error: /usr/bin/wg-quick: line 32: resolvconf: command not found sudo pacman -S openresolv WARP å¯†é’¥è·å–ï¼šTelegram ä¸­ Warp+ Bot è·å– 2.é…ç½®æ–‡ä»¶ç”Ÿæˆï¼šhttps://replit.com/@misaka-blog/wgcf-profile-generator?v=1 https://replit.com/@tianenxd/wgcf-profile-generatorï¼Œéœ€è¦ç™»é™† 3.ä¼˜é€‰IP ==warp-yxip== wget -N https://gitlab.com/Misaka-blog/warp-script/-/raw/main/files/warp-yxip/warp-yxip.sh \u0026\u0026 bash warp-yxip.sh ","date":"2024-04-17","objectID":"/archlinuxnote/:3:15","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"Clash Verge è§£å†³DNSæ³„éœ²é—®é¢˜ DNS æ³„éœ²å…¶å®å¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„å®šä¹‰ï¼Œä¹Ÿä¸å­˜åœ¨ä¸€ä¸ªå®˜æ–¹è§£é‡Šã€‚ å¤§æ¦‚å°±æ˜¯è¯´ä½ è®¿é—®YouTubeç­‰é»‘åå•ç½‘ç«™çš„æ—¶å€™ï¼Œä½¿ç”¨ä¸­å›½å¤§é™†çš„DNSæœåŠ¡å™¨è¿›è¡Œäº†è§£æï¼Œè¿™å¯èƒ½å¯¼è‡´éšç§é—®é¢˜çš„ã€‚ å¦‚æœåœ¨ DNS Leak Test ã€ipleakè¿™ç§ç½‘ç«™çš„åˆ—è¡¨ä¸­çœ‹åˆ°äº†ä¸­å›½å›½æ——ï¼Œå°±è¦æ„è¯†åˆ°å¯èƒ½å‘ç”Ÿäº†DNSæ³„éœ²ã€‚ è™½ç„¶æ²¡æœ‰äººçŸ¥é“å…·ä½“çš„æ¢æµ‹æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Œä½†å¾ˆå¯èƒ½æ˜¯ä»ç½‘ç»œå±‚é¢è·å–çš„ã€‚åœ¨ä¸€èˆ¬çš„å®¶åº­ç½‘ç»œæ‹“æ‰‘ä¸­ï¼Œwiresharkå¯ä»¥çœ‹åˆ°ä»€ä¹ˆå†…å®¹ï¼Œè¿è¥å•†å°±èƒ½çœ‹è§ä»€ä¹ˆå†…å®¹ï¼Œæ‰€ä»¥ä½ ä½¿ç”¨114.114.114.114ã€223.5.5.5è¿™æ ·çš„DNSè§£æå»è®¿é—®äº†ä»€ä¹ˆç½‘ç«™æ˜¯å¾ˆæ¸…æ™°çš„ã€‚ Clashå¼€å¯TUNæ¨¡å¼ï¼Œå…³é—­ç³»ç»Ÿä»£ç†å»ä½¿ç”¨ï¼šä¸æ™®é€šçš„ç³»ç»Ÿä»£ç†æ¨¡å¼åŒºåˆ«åœ¨äºï¼ŒTUNæ¨¡å¼ä¸‹Clashä¼šåˆ›å»ºä¸€å¼ è™šæ‹Ÿç½‘å¡ï¼Œä»ç½‘ç»œå±‚é¢æ¥ç®¡æ‰€æœ‰çš„ç½‘ç»œæµé‡ã€‚ Step 1: å¼€å¯TUNæ¨¡å¼ Step 2: ä½¿ç”¨ç¨³å®šçš„DNS DNSè¿™éƒ¨åˆ†æœ‰äººä¼šæ•™ä½¿ç”¨è¿è¥å•†çš„DNSï¼Œè¿è¥å•†çš„DNSåªé€‚åˆå°ç™½ç”¨æˆ·ï¼Œå› ä¸ºä»–å¯èƒ½è¿åè¯ˆï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨å›½å†…å¤§å‚çš„ã€‚ [Optional] å…³é—­æµè§ˆå™¨çš„QUIC, ä¸­å›½å¤§é™†çš„ispæ˜¯é™é€Ÿudpçš„, æ‰€ä»¥å¯¼è‡´QUICè¿™ä¸ªä¼˜ç§€çš„åè®®, åˆ°äº†ä¸­å›½å¤§é™†çš„ç½‘ç»œä¸‹æˆäº†ä¸ªè´Ÿé¢å¢ç›Šæ•ˆæœã€‚ about://flags/#enable-quic è®¾ç½®ä¸ºDisabled (ç‚¹ä¸‹æ–¹å¼¹å‡ºçš„é‡å¯æµè§ˆå™¨ç”Ÿæ•ˆ) å…³é—­æµè§ˆå™¨ä¸­çš„â€œå®‰å…¨DNSâ€ chrome://settings/security åœ¨Clash Vergeçš„ã€Profilesã€‘ä¸­ï¼Œç‚¹å³ä¸Šè§’çš„\"NEW\" -\u003e Typeé€‰æ‹©\"Script\" -\u003e Nameéšæ„å¡«å†™(ä¾‹å¦‚ï¼Œâ€œä¿®æ”¹DNSâ€) å³å‡»æ–°å»ºçš„æ–‡ä»¶ï¼Œç„¶å\"Edit File\"ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹åå¯ç”¨ï¼š function main(content) { const isObject = (value) =\u003e { return value !== null \u0026\u0026 typeof value === 'object' } const mergeConfig = (existingConfig, newConfig) =\u003e { if (!isObject(existingConfig)) { existingConfig = {} } if (!isObject(newConfig)) { return existingConfig } return { ...existingConfig, ...newConfig } } const cnDnsList = [ 'tls://223.5.5.5', 'tls://1.12.12.12', ] const trustDnsList = [ 'https://doh.apad.pro/dns-query', 'https://dns.cooluc.com/dns-query', 'https://1.0.0.1/dns-query', ] const notionDns = 'tls://dns.jerryw.cn' const notionUrls = [ 'http-inputs-notion.splunkcloud.com', '+.notion-static.com', '+.notion.com', '+.notion.new', '+.notion.site', '+.notion.so', ] const combinedUrls = notionUrls.join(','); const dnsOptions = { 'enable': true, 'default-nameserver': cnDnsList, // ç”¨äºè§£æDNSæœåŠ¡å™¨ çš„åŸŸå, å¿…é¡»ä¸ºIP, å¯ä¸ºåŠ å¯†DNS 'nameserver-policy': { [combinedUrls]: notionDns, 'geosite:geolocation-!cn': trustDnsList, }, 'nameserver': trustDnsList, // é»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨, å¦‚ä¸é…ç½®fallback/proxy-server-nameserver, åˆ™æ‰€æœ‰åŸŸåéƒ½ç”±nameserverè§£æ } // GitHubåŠ é€Ÿå‰ç¼€ const githubPrefix = 'https://ghproxy.lainbo.com/' // GEOæ•°æ®GitHubèµ„æºåŸå§‹ä¸‹è½½åœ°å€ const rawGeoxURLs = { geoip: 'https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat', geosite: 'https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat', mmdb: 'https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb', } // ç”Ÿæˆå¸¦æœ‰åŠ é€Ÿå‰ç¼€çš„GEOæ•°æ®èµ„æºå¯¹è±¡ const accelURLs = Object.fromEntries( Object.entries(rawGeoxURLs).map(([key, githubUrl]) =\u003e [key, `${githubPrefix}${githubUrl}`]), ) const otherOptions = { 'unified-delay': true, 'tcp-concurrent': true, 'profile': { 'store-selected': true, 'store-fake-ip': true, }, 'sniffer': { enable: true, sniff: { TLS: { ports: [443, 8443], }, HTTP: { 'ports': [80, '8080-8880'], 'override-destination': true, }, }, }, 'geodata-mode': true, 'geox-url': accelURLs, } content.dns = mergeConfig(content.dns, dnsOptions) return { ...content, ...otherOptions } } è®¾ç½®å®Œæˆåï¼ŒéªŒè¯DNSè§£æç»“æœæ˜¯å¦éƒ½æ˜¯æ¥è‡ªå›½å¤–çš„Cloudflareå’ŒGoogleçš„DNS, è¿™æ—¶èŠ‚ç‚¹æœåŠ¡å™¨ä¸ç®¡æ‹¿åˆ°äº†ä½ ä¼ è¿‡å»çš„çœŸipè¿˜æ˜¯å‡ipåœ°å€, ä»–éƒ½ä¼šå†å»è¯·æ±‚ä¸€æ¬¡Cloudflare/Googleçš„DNSæœåŠ¡, ç¡®ä¿è§£æçš„æ­£ç¡®æ€§ã€‚ é‡è¦çš„æ˜¯æ²¡æœ‰ä¸­å›½å¤§é™†çš„DNSæœåŠ¡å™¨äº†ï¼Œå¦‚æœè¿˜æ˜¯æœ‰ï¼Œé‚£ä½ åº”è¯¥å¾€å½“å‰è®¾å¤‡çš„æ›´ä¸Šå±‚å¯»æ‰¾é—®é¢˜æ‰€åœ¨ï¼Œæ¯”å¦‚è·¯ç”±å™¨çš„è®¾ç½®ç­‰ã€‚ Clash Verge è§£å†³ GEOIPï¼ŒCNé—®é¢˜ ç›®å‰å¸‚é¢ä¸Šç»å¤§å¤šæ•°çš„ä»£ç†å·¥å…·éƒ½ä¾èµ–äº GeoIP2 æ•°æ®åº“åˆ¤æ–­åœ°å€æ‰€å±åœ°ã€‚å®ƒä»¬çš„è§„åˆ™ç»“å°¾éƒ¨åˆ†ä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€æ¡ç±»ä¼¼ GEOIP, CNï¼Œç”¨æ¥æŸ¥è¯¢ç›®çš„ IP åœ°å€æ˜¯å¦å±äºä¸­å›½å¤§é™†ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦ç›´è¿ã€‚ è¿™äº›ä»£ç†å·¥å…·é€šå¸¸ä½¿ç”¨çš„ GeoIP2 æ•°æ®åº“æ˜¯æ¥è‡ªäº MaxMind çš„ GeoLite2 å…è´¹æ•°æ®åº“ã€‚è¿™ä¸ªæ•°æ®åº“ç›®å‰å­˜åœ¨ä¸€ä¸‹å‡ ä¸ªé—®é¢˜ï¼š è·å–ä¸ä¾¿ï¼šä» 2019 å¹´ 12 æœˆ 30 æ—¥èµ·ï¼Œå¿…é¡»æ³¨å†Œåæ‰èƒ½ä¸‹è½½ æ•°æ®é‡å¤§ï¼šæ•°æ®åº“åºå¤§ï¼ŒåŒ…å«å…¨çƒçš„ IP åœ°å€æ®µï¼Œçº¦ 10 MB å‡†ç¡®åº¦ä½ï¼šå¯¹ä¸­å›½å¤§é™†çš„ IP åœ°å€åˆ¤å®šä¸å‡†ï¼Œå¦‚ï¼šé¦™æ¸¯é˜¿é‡Œäº‘çš„ IP è¢«åˆ¤å®šä¸ºæ–°åŠ å¡ã€ä¸­å›½å¤§é™†ç­‰ã€‚ åºå¤§çš„æ•°æ®é‡å¯¹äºå¤§å¤šæ•°ä¸­å›½å¤§é™†çš„ç”¨æˆ·æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºåªä»…éœ€è¦å»åˆ¤æ–­ IP çš„åœ°ç†ä½ç½®æ˜¯å¦å±äºä¸­å›½å¤§é™†å¢ƒå†…ï¼Œå…¶ä»–å›½å®¶çš„ IP ä¸€å¾‹ä»£ç†/ç›´è¿ã€‚è¿‡å¤šçš„æ•°æ®é‡ä¼šå¢åŠ è½½å…¥æ—¶é—´ï¼Œé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚ æˆ‘ä»¬åœ¨ä¹‹å‰åˆ›å»ºçš„Scriptä¸­å·²ç»åŒ…å«äº†ä¸‹è½½æ›´ç²¾ç®€åˆé€‚ä¸­å›½å¤§é™†çš„IPæ•°æ®åº“é“¾æ¥, ç°åœ¨åªéœ€è¦æ‰‹åŠ¨æ“ä½œä¸‹è½½å’Œæ›¿æ¢å³å¯: Update GeoData: Clash Verge Revçš„è®¾ç½®èœå•ä¸­ç‚¹å‡»Update GeoData éªŒè¯ä¸‹è½½: æ‰“å¼€Clash Vergeæ‰˜ç›˜ä¸­çš„APP Dirï¼Œæ‰¾åˆ°geoip.datæ–‡ä»¶ï¼ŒéªŒè¯å…¶å¤§å°æ˜¯å¦ä¸ºå‡ ç™¾KB é‡å¯Clash Vergeï¼šç¡®ä¿æ•°æ®åº“è¢«æ­£ç¡®åº”ç”¨ ","date":"2024-04-17","objectID":"/archlinuxnote/:3:16","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"ä¸‰ã€System optimization ","date":"2024-04-17","objectID":"/archlinuxnote/:4:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"SSD ä¼˜åŒ– TRIM, ä¼šå¸®åŠ©æ¸…ç†SSDä¸­çš„å—ï¼Œä»è€Œå»¶é•¿SSDçš„ä½¿ç”¨å¯¿å‘½ sudo systemctl enable fstrim.timer sudo systemctl start fstrim.timer ","date":"2024-04-17","objectID":"/archlinuxnote/:4:1","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"SWAP è®¾ç½® https://wiki.archlinux.org/title/Swap#Swappiness æŸ¥çœ‹ swap ä½¿ç”¨ç‡ï¼Œä¸€èˆ¬æ˜¯ 60 ï¼Œæ„æ€æ˜¯ 60% çš„æ¦‚ç‡å°†å†…å­˜æ•´ç†åˆ° swap: cat /proc/sys/vm/swappiness ä¿®æ”¹ swap ä½¿ç”¨ç­–ç•¥ä¸º 10%ï¼Œå³ 10% çš„æ¦‚ç‡å°†å†…å­˜æ•´ç†åˆ° swap: sudo sysctl -w vm.swappiness=10 ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼šsudo vim /etc/sysctl.d/99-swappiness.conf åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šä¸‹é¢è¿™è¡Œå†…å®¹ï¼švm.swappiness=10 é‡å¯åå¯æŸ¥çœ‹ swappiness çš„å€¼ ","date":"2024-04-17","objectID":"/archlinuxnote/:4:2","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"Systemd journal size limit æ§åˆ¶æ—¥å¿—æœ€å¤§å¯ä½¿ç”¨å¤šå°‘ç£ç›˜ç©ºé—´ï¼Œä¿®æ”¹/etc/systemd/journald.conf ä¸­çš„SystemMaxUseå‚æ•° SystemMaxUse=50M ","date":"2024-04-17","objectID":"/archlinuxnote/:4:3","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"å››ã€Games sdl-ball: yay -S sdl-ball ","date":"2024-04-17","objectID":"/archlinuxnote/:5:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"äº”ã€Problem And Solution ","date":"2024-04-17","objectID":"/archlinuxnote/:6:0","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"1. clear command - terminals database is inaccessible è§£å†³æ–¹æ¡ˆï¼šPath for Anaconda3 is set in .bashrc. It is interfering with the clear command. Removing Anaconda path from path solved the issue. ~ echo $CONDA_PREFIX (base) /opt/miniconda sudo mv $CONDA_PREFIX/bin/clear $CONDA_PREFIX/bin/clear_old ","date":"2024-04-17","objectID":"/archlinuxnote/:6:1","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"2. tput: unknown terminal \"xterm-256color\" è§£å†³æ–¹æ¡ˆï¼šsetenv TERMINFO /usr/lib/terminfowps ","date":"2024-04-17","objectID":"/archlinuxnote/:6:2","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"3. æ›´æ–°å†…æ ¸åï¼ŒåŒå±æ˜¾ç¤ºæ—¶ï¼ŒæŸä¸€ä¸ªå±å¹•é»‘å±ï¼Œä½†é¼ æ ‡èƒ½å¤Ÿç§»åŠ¨è¿‡å»å¹¶æ˜¾ç¤ºï¼Œå¦ä¸€å±å¹•æ­£å¸¸ è§£å†³æ–¹æ¡ˆï¼šxrandr --output HDMI-1-0 --right-of eDP1 --auto å‘½ä»¤è§£é‡Šï¼šé…ç½® HDMI-1-0 è¾“å‡ºï¼Œä½¿å…¶ä½äº eDP1 è¾“å‡ºçš„å³ä¾§ï¼Œå¹¶è‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„åˆ†è¾¨ç‡å’Œåˆ·æ–°ç‡è®¾ç½® $ xrandr --listmonitors Monitors: 2 0: +*eDP1 2560/360x1440/200+0+0 eDP1 1: +HDMI-1-0 1920/479x1080/260+2560+0 HDMI-1-0 $ xrandr --output HDMI-1-0 --right-of eDP1 --auto ","date":"2024-04-17","objectID":"/archlinuxnote/:6:3","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"4. zip å‹ç¼©åŒ…è§£å‹ä¹±ç  äº§ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› æ˜¯ï¼Œzip æ ¼å¼æœ¬èº«çš„ç¼ºé™·å¯¼è‡´çš„ï¼š**zip æ ¼å¼æ²¡æœ‰æŒ‡å®šæ–‡ä»¶åçš„ç¼–ç æ ¼å¼ï¼Œå› æ­¤åœ¨å‹ç¼©å’Œè§£å‹æ—¶éƒ½ä¼šé‡‡ç”¨OSæœ¬åœ°ç¼–ç ï¼Œè€Œ Window ä¸‹ç®€ä½“ä¸­æ–‡é‡‡ç”¨çš„æ˜¯ GBK/GB312 ç¼–ç ï¼ŒLinux åˆ™é‡‡ç”¨çš„æ˜¯ UTF-8 ç¼–ç ï¼Œä¸¤è€…ä¸ä¸€è‡´å¯¼è‡´äº†ä¹±ç çš„äº§ç”Ÿã€‚ è§£å†³æ–¹æ¡ˆ: unzip -O GBK xxx.zip ","date":"2024-04-17","objectID":"/archlinuxnote/:6:4","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"5. wps-officeå¤§éƒ¨åˆ†å­—ä½“ç²—ä½“å‡ºç°è¿‡ç²—æ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜ é—®é¢˜: freetype2æ›´æ–°è‡³2.13.0ä»¥ä¸Šç‰ˆæœ¬åå‡ºç°çš„é—®é¢˜ã€‚å¯¼è‡´wps-office æ–‡æ¡£ç¼–è¾‘æ–‡å­—å¤§éƒ¨åˆ†å­—ä½“è®¾ç½®ç²—ä½“å‡ºç°è¿‡ç²—æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚ è§£å†³æ–¹æ¡ˆï¼šfreetype2 é™çº§è‡³ 2.13.0 Downloadfreetype2.13.0 é™çº§ sudo pacman -U freetype2-2.13.0-1-x86_64.pkg.tar.zst ä¿®æ”¹ /etc/pacman.conf -\u003e IgnorePkg = freetype2ï¼Œæ’é™¤æ‰è¿™ä¸ªåŒ…ï¼ˆä¸è®©å®ƒæ›´æ–°ï¼‰ freetype2: ignoring package upgrade (2.13.0-1 =\u003e 2.13.2-1) env LD_LIBRARY_PATH=/usr/local/freetype2-2.13.0-1-x86_64/usr/lib `update-desktop-database ~/.local/share/applications ","date":"2024-04-17","objectID":"/archlinuxnote/:6:5","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"6. wpspdf æ— æ³•æ‰“å¼€ PDF æ–‡ä»¶ wpspdf ä¾èµ–äº libtiff5.so.5 ä»¥æ”¯æ’‘å…¶ PDF åŠŸèƒ½ã€‚è€Œç³»ç»Ÿæ›´æ–°åï¼ŒArch Linux æä¾›çš„æ˜¯ libtiff.so.6 æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œå¯¼è‡´å…¶æ— æ³•æ­£å¸¸å·¥ä½œã€‚ è§£å†³æ–¹æ¡ˆï¼šå®‰è£… libtiff5 ","date":"2024-04-17","objectID":"/archlinuxnote/:6:6","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"7. WPS æ— æ³•è¾“å…¥ä¸­æ–‡ è§£å†³æ–¹æ¡ˆ wpp wpspdf wpp et ","date":"2024-04-17","objectID":"/archlinuxnote/:6:7","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"8. lx-music æ•°æ®åŒæ­¥å¤±è´¥ ç¡®ä¿PCç«¯çš„åŒæ­¥æœåŠ¡å·²å¯ç”¨æˆåŠŸ: è‹¥è¿æ¥ç ã€åŒæ­¥æœåŠ¡åœ°å€æ²¡æœ‰å†…å®¹ï¼Œåˆ™è¯æ˜æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæ­¤æ—¶çœ‹å¯ç”¨åŒæ­¥åŠŸèƒ½å¤é€‰æ¡†åé¢çš„é”™è¯¯ä¿¡æ¯è‡ªè¡Œè§£å†³ åœ¨æ‰‹æœºæµè§ˆå™¨åœ°å€æ è¾“å…¥http://x.x.x.x:5963/helloåå›è½¦ï¼Œè‹¥æ­¤åœ°å€å¯ä»¥æ‰“å¼€å¹¶æ˜¾ç¤º Hello~::^-^::v4ï¼Œåˆ™è¯æ˜ç§»åŠ¨ç«¯ä¸PCç«¯ç½‘ç»œå·²äº’é€šï¼Œ è‹¥ç§»åŠ¨ç«¯æ— æ³•æ‰“å¼€ç¬¬2æ­¥çš„åœ°å€ï¼Œåˆ™åœ¨PCç«¯çš„æµè§ˆå™¨åœ°å€æ è¾“å…¥å¹¶æ‰“å¼€è¯¥åœ°å€ï¼Œè‹¥å¯ä»¥æ‰“å¼€ï¼Œåˆ™å¯èƒ½æ€§å¦‚ä¸‹ï¼š LX Music PCç«¯è¢«ç”µè„‘é˜²ç«å¢™æ‹¦æˆª PCç«¯ä¸ç§»åŠ¨ç«¯ä¸åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹ï¼Œ è·¯ç”±å™¨å¼€å¯äº†APéš”ç¦»ï¼ˆä¸€èˆ¬åœ¨å…¬å…±ç½‘ç»œä¸‹ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼‰ è¦éªŒè¯åŒæ–¹æ˜¯å¦åœ¨åŒä¸€ä¸ªç½‘ç»œæˆ–æ˜¯å¦å¼€å¯APéš”ç¦»ï¼Œå¯ä»¥åœ¨ç”µè„‘æ‰“å¼€cmdä½¿ç”¨pingå‘½ä»¤pingç§»åŠ¨ç«¯æ˜¾ç¤ºçš„ipåœ°å€ï¼Œè‹¥å¯ä»¥é€šåˆ™è¯´æ˜ç½‘ç»œæ­£å¸¸ ","date":"2024-04-17","objectID":"/archlinuxnote/:6:8","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"9. fatal: unable to access 'https://github.com/xxxxxxx.git/': Failed to connect to github.com port 443: Timed out é—®é¢˜ï¼šä»£ç†å‡ºé—®é¢˜ è§£å†³æ–¹æ¡ˆï¼š git config --global --unset http.proxy git config --global --unset https.proxy ","date":"2024-04-17","objectID":"/archlinuxnote/:6:9","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Linux","Software"],"content":"10. fatal: unable to access 'https://github.com/xxxx.git/': gnutls_handshake() failed: The TLS connection was non-properly terminated. è§£å†³æ–¹æ¡ˆï¼š git config --global http.sslVerify false ","date":"2024-04-17","objectID":"/archlinuxnote/:6:10","tags":["Arch","Linux","Software"],"title":"Arch Linux ä½¿ç”¨æŒ‡å—","uri":"/archlinuxnote/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"å€ŸåŠ©äº Github Pages æä¾›çš„é™æ€ç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼Œå¹¶é‡‡ç”¨äº† Hugo è¿™ä¸€å¼€æºé¡¹ç›®ï¼ŒåŠ å¿«äº†å»ºç«™æµç¨‹ï¼Œè€Œä¸”æœ‰å¤šç§å¼€æºç½‘ç«™ä¸»é¢˜å¯ä¾›é€‰æ‹©.","date":"2024-04-17","objectID":"/build-blog/","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"å€ŸåŠ©äº Github Pages æä¾›çš„é™æ€ç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼Œå¹¶é‡‡ç”¨äº† Hugo è¿™ä¸€å¼€æºé¡¹ç›®ï¼ŒåŠ å¿«äº†å»ºç«™æµç¨‹ï¼Œè€Œä¸”æœ‰å¤šç§å¼€æºç½‘ç«™ä¸»é¢˜å¯ä¾›é€‰æ‹©. ","date":"2024-04-17","objectID":"/build-blog/:0:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"I. å‰è¨€ åœ¨åšå®¢ç½‘ç«™æ­å»ºå®Œæˆä¹‹åï¼Œæœ‰å……åˆ†çš„ç†ç”±ç›¸ä¿¡ï¼Œè‡ªå·±åœ¨æœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…å°†ä¸ä¼šå†æ¬¡é‡å¤å»ºç«™ã€‚ å¸¸è¨€é“å¤©æœ‰ä¸æµ‹é£äº‘ï¼Œä¸ºäº†é˜²æ­¢å„ç§æ„å¤–æƒ…å†µå‘ç”Ÿï¼Œå¯¼è‡´æœ¬åšå®¢ç½‘ç«™æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼ŒåŒæ—¶é˜²æ­¢è‡ªå·±å¿˜è®°æ­å»ºæµç¨‹ï¼Œæ•…è®°å½•äºæ­¤ã€‚ ","date":"2024-04-17","objectID":"/build-blog/:1:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"II. æ•ˆæœ ","date":"2024-04-17","objectID":"/build-blog/:2:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"III. ç›¸å…³çŸ¥è¯†ç®€ä»‹ ","date":"2024-04-17","objectID":"/build-blog/:3:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"Github Pages GitHub Pages æ˜¯ä¸€ä¸ªå…è´¹çš„é™æ€ç½‘ç«™æ‰˜ç®¡æœåŠ¡ï¼Œå®ƒå…è®¸ç”¨æˆ·é€šè¿‡ GitHub å­˜å‚¨åº“æ¥æ‰˜ç®¡å’Œå‘å¸ƒç½‘é¡µï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å±•ç¤ºé¡¹ç›®æ–‡æ¡£ã€åšå®¢æˆ–ä¸ªäººç®€å†ã€‚ ç°é˜¶æ®µï¼ŒGithub Pages æ”¯æŒå…¬å…±å­˜å‚¨åº“çš„å…è´¹çš„æ‰˜ç®¡ï¼›å¯¹äºç§æœ‰ä»“åº“ï¼Œéœ€è¦è¿›è¡Œç¼´è´¹ã€‚ ","date":"2024-04-17","objectID":"/build-blog/:3:1","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"Hugo å®˜æ–¹å·ç§°ï¼ŒHugo æ˜¯ä¸–ç•Œä¸Šæœ€å¿«çš„ç½‘ç«™å»ºè®¾æ¡†æ¶(The worldâ€™s fastest framework for building websites)ã€‚ ","date":"2024-04-17","objectID":"/build-blog/:3:2","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"IV. Steps ","date":"2024-04-17","objectID":"/build-blog/:4:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"Github ä»“åº“åˆ›å»º éœ€è¦åˆ›å»ºä¸¤ä¸ªä»“åº“ï¼Œä¸€ä¸ªç”¨äºç½‘ç«™æºç ç®¡ç†(sA)ï¼Œä¸€ä¸ªç”¨äºç½‘ç«™éƒ¨ç½²(sB): sA å¯ä»¥æ˜¯ publicï¼Œä¹Ÿå¯ä»¥æ˜¯ privateï¼› sB ä»“åº“çš„åç§°å¿…é¡»æ˜¯ username.github.ioï¼ˆusername æ˜¯ Github Accout ä¸­usernameï¼Œä¸æ˜¯ profile ä¸­çš„ Nameï¼‰ï¼ŒåŒæ—¶è¿˜éœ€è¦æ·»åŠ  README.mdï¼› ","date":"2024-04-17","objectID":"/build-blog/:4:1","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"ä½¿ç”¨ Hugo åˆ›å»ºç½‘ç«™ é¦–å…ˆï¼Œä½¿ç”¨ Git å°† sA æ‹‰å–ä¸‹æ¥: ~/ $ git clone https://github.com/lutianen/Kyden-blog.git ç„¶åï¼Œè¿›å…¥æœ¬åœ°çš„ sA ç›®å½•ï¼ˆå³ï¼ŒKyden-blogï¼‰ä¸‹ï¼Œä½¿ç”¨ hugo å»ºç«™ï¼š # Linux: Install ~/Kyden-blog $ sudo pacman -S hugo ~/Kyden-blog $ hugo version # å»ºç«™ï¼Œç„¶åå°†ç”Ÿæˆçš„å†…å®¹å¤åˆ¶åˆ° `sA` ä»“åº“ä¸­ ~/Kyden-blog $ hugo new Kyden-blog ~/Kyden-blog $ mv Kyden-blog/ . ~/Kyden-blog $ rm Kyden-blog -rf ","date":"2024-04-17","objectID":"/build-blog/:4:2","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"Hugo è®¾ç½®ç½‘ç«™ä¸»é¢˜ å¯ä»¥ä» Hugo Themes æŒ‘é€‰åˆé€‚çš„ä¸»é¢˜è¿›è¡Œåº”ç”¨ï¼š ~/Kyden-blog $ cd themes ~/Kyden-blog/themes $ git clone https://github.com/kakawait/hugo-tranquilpeak-theme.git tranquilpeak å®‰è£… Hugo ä¸»é¢˜åï¼Œæ ¹æ®ä¸ªäººæƒ…å†µä¿®æ”¹ç›¸åº”çš„é…ç½®æ–‡ä»¶å³å¯ï¼› ","date":"2024-04-17","objectID":"/build-blog/:4:3","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"æ–‡ç« ç®¡ç† å¯åŠ¨ Hugo server å¯åŠ¨æœ¬åœ° serverï¼š ~/Kyden-blog $ hugo server -D æµè§ˆå™¨æ‰“å¼€ http://localhost:1313/ è¿›è¡Œé¢„è§ˆï¼› æ–°å»ºæ–‡ç«  ~/Kyden-blog $ hugo new content `post/Golang/Go.md` # `post/Golang/Go.md` è¡¨æ˜ markdown çš„è·¯å¾„ éƒ¨ç½²æ–‡ç«  æ„å»º Hugo ç½‘ç«™ç›¸å…³é™æ€æ–‡ä»¶ Hugo å°†æ„å»ºå®Œæˆçš„é™æ€å†…å®¹ä¿å­˜åˆ° sA ä»“åº“ä¸­çš„ public æ–‡ä»¶å¤¹ä¸­ï¼› ~/Kyden-blog $ hugo éƒ¨ç½² è¿›å…¥ public ç›®å½•ï¼Œåˆ©ç”¨ Git è¿›è¡Œç®¡ç†è¯¥æ–‡ä»¶å¤¹ï¼Œå¹¶æ¨é€åˆ°è¿œç¨‹ sB ä»“åº“ä¸­ï¼š ~/Kyden-blog/public $ git init ~/Kyden-blog/public $ git commit -m \"first commit\" ~/Kyden-blog/public $ git branch -M master ~/Kyden-blog/public $ git remote add origin https://github.com/lutianen/lutianen.github.io.git ~/Kyden-blog/public $ git push -u origin master è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šdeploy.sh #!/bin/bash echo -e \"\\033[0;32mDeploying updates to GitHub...\\033[0m\" # Build the project. hugo # if using a theme, replace with hugo -t # Go To Public folder cd public # Add changes to git. git add . # Commit changes. msg=\"rebuilding site `date` \" echo -e \"\\033[0;32m$msg\\033[0m\" if [ $# -eq 1 ] then msg=\"$1\" fi git commit -m \"$msg\" # Push source and build repos. git push origin master # Come Back up to the Project Root cd .. åˆ é™¤æ–‡ç«  è¿›å…¥ Kyden-blog/post/ ç›®å½•ä¸­ï¼Œåˆ é™¤ï¼Œç›®æ ‡æ–‡ä»¶å¤¹ï¼ˆåŒ…å«ç›¸å…³æ–‡ç« èµ„æºï¼‰å³å¯ï¼› NOTEï¼šKyden-blog/public ä¸­ç›¸å…³æ–‡ä»¶å¯ä»¥åˆ é™¤ï¼Œä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼Œæ¨èåˆ é™¤ï¼› ","date":"2024-04-17","objectID":"/build-blog/:4:4","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"Google Analyticsï¼ˆåˆ†æï¼‰ é¦–å…ˆï¼Œåœ¨ GA ç½‘ç«™ä¸­æ³¨å†Œã€è®¾ç½®å®Œæˆç›¸åº”é€‰é¡¹ï¼Œå³å¯è·å– IDï¼šG-XXXXXXXXXXï¼› ç„¶ååœ¨ layout/_default/baseof.html æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç å³å¯ï¼š \u003c!-- Google tag (gtag.js) --\u003e \u003cscript async src=\"https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX\"\u003e\u003c/script\u003e \u003cscript\u003e window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XXXXXXXXXX'); \u003c/script\u003e è¯¥æ®µä»£ç è·å–æ–¹æ³•å¦‚ä¸‹ï¼šGoogle Analyticsï¼ˆåˆ†æï¼‰ -\u003e ç®¡ç† -\u003e â€œåª’ä½“èµ„æºè®¾ç½®\"åˆ—ä¸­çš„æ•°æ®æµ -\u003e ç½‘ç«™ -\u003e å¯¹åº”çš„æ•°æ®æµ -\u003e â€œGoogle ä»£ç â€ ä¸‹çš„æŸ¥çœ‹ä»£ç è¯´æ˜ -\u003e â€œå®‰è£…è¯´æ˜â€ é€‰æ‹©æ‰‹åŠ¨æ·»åŠ  å»ºè®®æ·»åŠ å®Œæˆåï¼Œåœ¨GAåˆ†æä¸­è¿›è¡Œæµ‹è¯•ï¼Œç¡®ä¿ç”Ÿæ•ˆ ","date":"2024-04-17","objectID":"/build-blog/:4:5","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"è¯„è®ºç³»ç»Ÿ - Gitalk éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGitalk çš„è¯„è®ºé‡‡ç”¨çš„æ˜¯ PR/Issue çš„æ–¹å¼å­˜å‚¨è¯„è®ºï¼Œå› æ­¤ï¼Œä¸€èˆ¬éœ€è¦æ–°å»ºä¸€ä¸ªä¸“é—¨çš„ Repoï¼Œä¾‹å¦‚username/gitalk. ç”³è¯·æ³¨å†Œæ–°åº”ç”¨ï¼Œå¹¶å¡«å†™ä»¥ä¸‹ç›¸å…³å†…å®¹ï¼š Application name: éšæ„ Homepage URL: åŒ…å« http/https å‰ç¼€ï¼Œä¾‹å¦‚https://lutianen.github.io Authorization callback URL: å’Œä¸Šé¢ Homepage URL ä¿æŒä¸€è‡´å°±è¡Œ æ³¨å†Œå®Œæˆåï¼Œæ‰‹åŠ¨ç”Ÿæˆ Client secrets(åªä¼šå‡ºç°ä¸€æ¬¡)ï¼ŒåŒæ—¶è·å¾— Client ID. æœ€åï¼Œåœ¨ä¸»é¢˜è®¾ç½®ä¸­å¡«å†™ç›¸åº”ä¿¡æ¯å³å¯ï¼Œä¾‹å¦‚ LoveIt ä¸­çš„ config.toml: [params.page.comment] enable = true [params.page.comment.gitalk] enable = true owner = \"lutianen\" repo = \"gitalk\" clientId = \"xxxxxxxxxxxxxxxxxxxx\" clientSecret = \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\" ","date":"2024-04-17","objectID":"/build-blog/:4:6","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"ç½‘ç«™è¿è¡Œæ—¶é—´ç»Ÿè®¡ åœ¨ footer.html åŠ å…¥ä»¥ä¸‹å†…å®¹å³å¯ï¼š {{- /* runtime */ -}} \u003c/br\u003e\u003cscript\u003e function siteTime() { var seconds = 1000; var minutes = seconds * 60; var hours = minutes * 60; var days = hours * 24; var years = days * 365; var today = new Date(); var startYear = 2024; var startMonth = 4; var startDate = 18; var startHour = 12; var startMinute = 57; var startSecond = 2; var todayYear = today.getFullYear(); var todayMonth = today.getMonth() + 1; var todayDate = today.getDate(); var todayHour = today.getHours(); var todayMinute = today.getMinutes(); var todaySecond = today.getSeconds(); var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond); var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond); var diff = t2 - t1; var diffYears = Math.floor(diff / years); var diffDays = Math.floor((diff / days) - diffYears * 365); var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours); var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes); var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds); if (startYear == todayYear) { document.getElementById(\"sitetime\").innerHTML = \"å·²å®‰å…¨è¿è¡Œ \" + diffDays + \" å¤© \" + diffHours + \" å°æ—¶ \" + diffMinutes + \" åˆ†é’Ÿ \" + diffSeconds + \" ç§’\"; } else { document.getElementById(\"sitetime\").innerHTML = \"å·²å®‰å…¨è¿è¡Œ \" + diffYears + \" å¹´ \" + diffDays + \" å¤© \" + diffHours + \" å°æ—¶ \" + diffMinutes + \" åˆ†é’Ÿ \" + diffSeconds + \" ç§’\"; } } setInterval(siteTime, 1000); \u003c/script\u003e \u003cspan id=\"sitetime\"\u003eè½½å…¥è¿è¡Œæ—¶é—´...\u003c/span\u003e ","date":"2024-04-17","objectID":"/build-blog/:4:7","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"V. Problem And Solution ","date":"2024-04-17","objectID":"/build-blog/:5:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"æ·»åŠ å›¾ç‰‡ä¸æ˜¾ç¤º Hugo çš„é…ç½®æ–‡ä»¶å’Œæ–‡ç« ä¸­çš„å¼•ç”¨å›¾ç‰‡éƒ½æ˜¯ä»¥ static ä½œä¸ºæ ¹ç›®å½•ï¼Œå› æ­¤å›¾ç‰‡æ— æ³•æ˜¾ç¤ºçš„è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š å°†å›¾ç‰‡æ”¾å…¥ static/img ç›®å½•ä¸‹ åœ¨æ–‡ç« ä¸­çš„å›¾ç‰‡å¼•ç”¨æ–¹å¼ä¸ºï¼š/img/xxx.png æ— æ³•é‡‡ç”¨ Typora ç­‰è½¯ä»¶è¿›è¡Œé¢„è§ˆï¼Œéœ€è¦åœ¨ç½‘é¡µä¸­è¿›è¡Œé¢„è§ˆ: http://localhost:1313/ ","date":"2024-04-17","objectID":"/build-blog/:5:1","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"æ–‡ç« ç¼©ç•¥ å¦‚æœæƒ³è¦æ–‡ç« åœ¨æŸä¸ªåœ°æ–¹ç¼©ç•¥ï¼Œåªéœ€è¦åœ¨è¯¥ä½ç½®åŠ å…¥ \u003c!--more--\u003e å³å¯ã€‚ ","date":"2024-04-17","objectID":"/build-blog/:5:2","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"},{"categories":["Github Pages","Hugo","åšå®¢","Linux"],"content":"VI. References Abot Github Pages Hugo å‚è€ƒæ–‡ç«  Gitalk è¯„è®ºç³»ç»Ÿå®‰è£… ","date":"2024-04-17","objectID":"/build-blog/:6:0","tags":["Github Pages","Hugo","åšå®¢","Linux"],"title":"GitHub Pages + Hugo å»ºåšå®¢ç«™","uri":"/build-blog/"}]